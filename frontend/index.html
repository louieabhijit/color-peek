<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Color-Peek - Extract Colors from Images | Free Color Picker & Palette Tool
    </title>
    <meta
      name="description"
      content="Free online color picker from image. Extract dominant colors, copy HEX & RGB values, and build color palettes for web design and branding."
    />
    <meta
      name="keywords"
      content="color picker from image, extract colors from image, hex color extractor, generate color palette, image color analyzer, dominant color detector, RGB and HEX color finder, design tools for color, color harmony generator, web design color picker, color palette from photo, UI/UX color tool, WCAG 2.1, color contrast accessibility, contrast ratio, accessible design, ADA compliance, contrast checker"
    />
    <meta name="author" content="Abhijit, ColorPeek" />
    <meta name="robots" content="index, follow" />
    <meta name="theme-color" content="#2563eb" />

    <!-- Canonical URL -->
    <link rel="canonical" href="https://color-peek.com" />

    <!-- Favicon and Icons -->
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/assets/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/assets/favicon-16x16.png"
    />
    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/assets/apple-touch-icon.png"
    />
    <link rel="manifest" href="/assets/site.webmanifest" />

    <!-- Open Graph for Social Sharing -->
    <meta
      property="og:title"
      content="ColorPeek - Extract Colors from Images"
    />
    <meta
      property="og:description"
      content="Upload an image to generate color palettes, hex codes, and harmonies. Perfect for UI/UX, branding, and design!"
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://color-peek.com" />
    <meta
      property="og:image"
      content="https://color-peek.com/assets/og-image.jpg"
    />

    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="ColorPeek - Extract Colors from Any Image"
    />
    <meta
      name="twitter:description"
      content="Upload an image and get instant color palettes, HEX/RGB codes, and design-ready color harmonies."
    />
    <meta
      name="twitter:image"
      content="https://color-peek.com/assets/og-image.jpg"
    />
    <meta name="twitter:creator" content="@yourhandle" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#2563eb",
            },
            fontFamily: {
              sans: ["Inter", "sans-serif"],
            },
          },
        },
      };
    </script>

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "ColorPeek",
        "url": "https://color-peek.com",
        "description": "Extract colors from images, generate palettes, and find color harmonies for design projects.",
        "applicationCategory": "DesignApplication",
        "operatingSystem": "All",
        "offers": {
          "@type": "Offer",
          "price": "0"
        }
      }
    </script>

    <!-- Structured Data for Rich Snippets -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "ColorPeek",
        "url": "https://color-peek.com",
        "description": "Extract colors from images, generate color palettes, and find color harmonies for design projects.",
        "applicationCategory": "DesignApplication",
        "offers": {
          "@type": "Offer",
          "price": "0"
        },
        "operatingSystem": "Any"
      }
    </script>

    <!-- Force dark mode if saved in localStorage -->
    <script>
      (function () {
        // Only apply dark mode if explicitly saved in localStorage
        if (localStorage.getItem("theme") === "dark") {
          document.documentElement.classList.add("dark-mode");
          document.documentElement.classList.add("dark");
        } else {
          // Default to light mode if no preference is set
          document.documentElement.classList.remove("dark-mode");
          document.documentElement.classList.remove("dark");
        }
      })();
    </script>
    <style>
      /* Modern CSS Variables for Light Mode */
      :root {
        --transition: all 0.3s ease;
        --font-sans: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Helvetica, Arial, sans-serif;
        --primary: #2563eb;
        --bg: #f8fafc; /* Light background */
        --text-color: #1e293b;
        --navbar-bg: linear-gradient(to right, #0f172a, #1e293b);
        --navbar-text: #f8fafc;
        --bg-nav: rgba(255, 255, 255, 0.5);
        --color-text: #0f172a;
        --navlink-hover: #2563eb;
      }
      /* Dark Mode Variables */
      .dark-mode {
        --primary: #3b82f6;
        --bg: #0f172a;
        --text-color: #f1f5f9;
        --navbar-bg: linear-gradient(to right, #020617, #0f172a);
        --navbar-text: #f8fafc;
        --bg-nav: rgba(15, 23, 42, 0.5);
        --color-text: #f8fafc;
        --navlink-hover: #93c5fd;
      }

      /* Ensure error banner is always hidden */
      #backendErrorBanner {
        display: none !important;
      }

      /* Animation for newly added colors */
      @keyframes highlight-pulse {
        0% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.7);
        }
        50% {
          transform: scale(1.05);
          box-shadow: 0 0 0 10px rgba(37, 99, 235, 0);
        }
        100% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(37, 99, 235, 0);
        }
      }

      .highlight-pulse {
        animation: highlight-pulse 1s ease-in-out;
      }

      /* Animation for color-item highlight */
      .color-item.highlight-pulse {
        z-index: 20;
        position: relative;
        animation: color-item-pulse 1s ease-in-out;
      }

      @keyframes color-item-pulse {
        0% {
          flex: 1;
          box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7);
        }
        50% {
          flex: 2.5;
          box-shadow: 0 0 20px 0 rgba(255, 255, 255, 0.7);
        }
        100% {
          flex: 1;
          box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
        }
      }

      .color-item.highlight-pulse span {
        opacity: 1;
      }

      /* Global Styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        font-size: 16px;
        scroll-behavior: smooth;
      }

      body {
        font-family: var(--font-sans);
        background-color: var(--bg);
        color: var(--text-color);
        line-height: 1.6;
        overflow-x: hidden;
        transition: background-color 0.3s ease, color 0.3s ease;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      /* Typography */
      h1 {
        font-size: 2.5rem;
        line-height: 1.2;
        margin: 2rem 0;
        color: var(--text-color);
        text-align: center;
      }

      /* Modern Scrollbar */
      ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
      }

      ::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.05);
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.15);
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: rgba(0, 0, 0, 0.25);
      }

      /* Dark mode scrollbar */
      .dark-mode::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
      }

      .dark-mode::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.15);
      }

      .dark-mode::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.25);
      }

      /* Animated gradient text */
      .gradient-text {
        background: linear-gradient(90deg, #2563eb, #4f46e5, #7c3aed, #2563eb);
        background-size: 300% 100%;
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: gradient 6s ease infinite;
      }

      /* From Uiverse.io by arshshaikh06 - Modern Color Palette */
      .palette-container {
        height: 200px;
        width: 100%;
        border-radius: 1em;
        overflow: hidden;
        box-shadow: none; /* Removed box shadow for flat appearance */
        font-family: sans-serif;
        margin-bottom: 20px;
      }

      .dark-mode .palette-container {
        box-shadow: none; /* Removed box shadow for flat appearance in dark mode */
      }

      .color-palette {
        display: flex;
        height: 86%;
        width: 100%;
      }

      .color-item {
        height: 100%;
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        letter-spacing: 1px;
        transition: flex 0.2s ease-in-out;
        position: relative;
        flex-direction: column;
        cursor: pointer;
      }

      .color-item span.color-hex {
        opacity: 0;
        transition: opacity 0.2s ease-in-out;
        font-family: monospace;
        font-size: 1rem;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
      }

      .color-item span.color-percent {
        opacity: 0;
        transition: opacity 0.2s ease-in-out;
        font-size: 0.8rem;
        margin-top: 4px;
      }

      .color-item:hover {
        flex: 2.2;
        box-shadow: rgba(100, 100, 111, 0.3) 0px 7px 29px 0px;
        z-index: 10;
      }

      .color-item:hover span {
        opacity: 1;
      }

      .palette-stats {
        height: 14%;
        width: 100%;
        background: white;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 1.5em;
        box-sizing: border-box;
        color: #8f8f8f;
        font-size: 0.9rem;
      }

      .dark-mode .palette-stats {
        background: #1f2937;
        color: #d1d5db;
      }

      .palette-stats svg {
        fill: #8f8f8f;
        transform: scale(1.2);
        cursor: pointer;
        transition: fill 0.2s ease;
      }

      .dark-mode .palette-stats svg {
        fill: #d1d5db;
      }

      .palette-stats svg:hover {
        fill: #2563eb;
      }

      /* Navbar */
      .navbar-container {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        width: 100%;
        display: flex;
        justify-content: center;
        padding: 12px 20px;
        z-index: 1000;
        box-sizing: border-box;
        pointer-events: none;
        transition: all 0.3s ease-in-out;
      }

      .navbar-container.scrolled {
        padding: 0;
      }

      .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 30px;
        background: rgba(255, 255, 255, 0.1); /* Reduced from 0.2 to 0.1 */
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        color: #0f172a;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
        width: 100%;
        max-width: 1400px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.02);
        border-radius: 50px;
        transition: all 0.3s ease-in-out;
        box-sizing: border-box;
        pointer-events: auto;
      }

      /* Add the scrolled styling */
      .navbar.scrolled {
        border-radius: 0;
        background: rgba(255, 255, 255, 0.02); /* Reduced from 0.05 to 0.02 */
        backdrop-filter: blur(
          6px
        ); /* Reduced from 8px to 6px for even lighter effect */
        -webkit-backdrop-filter: blur(6px);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03); /* Reduced shadow opacity */
        max-width: 100%;
        padding-left: 40px;
        padding-right: 40px;
        margin: 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.03); /* More subtle border */
      }

      .dark-mode .navbar.scrolled {
        background: rgba(15, 23, 42, 0.02); /* Reduced from 0.05 to 0.02 */
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        border-bottom: 1px solid rgba(255, 255, 255, 0.02);
      }

      .dark-mode .navbar {
        background: rgba(15, 23, 42, 0.2);
        backdrop-filter: blur(50px);
        -webkit-backdrop-filter: blur(50px);
        color: #f8fafc;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      .navbar:hover {
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
        background: rgba(255, 255, 255, 0.5);
      }

      .dark-mode .navbar:hover {
        background: rgba(15, 23, 42, 0.5);
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 1.25rem;
        font-weight: 600;
        color: #0f172a;
        letter-spacing: 0.5px;
      }

      .dark-mode .logo {
        color: #f8fafc;
      }

      .nav-right {
        display: flex;
        align-items: center;
        gap: 2rem;
      }

      .nav-links {
        display: flex;
        align-items: center;
        gap: 0; /* Remove gap as we'll handle spacing in nav-group */
        font-size: 0.875rem;
      }

      /* Enhanced group styling */
      .nav-links .nav-group {
        display: flex;
        align-items: center;
        gap: 1.25rem;
        padding: 0 1.5rem; /* Increased padding */
        position: relative; /* For pseudo-element positioning */
      }

      /* Enhanced divider styling */
      .nav-links .nav-group:not(:last-child)::after {
        content: "";
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        height: 1.5rem; /* Taller divider */
        width: 1px;
        background: linear-gradient(
          to bottom,
          transparent,
          currentColor,
          transparent
        );
        opacity: 0.2;
      }

      /* First and last groups special padding */
      .nav-links .nav-group:first-child {
        padding-left: 0;
      }

      .nav-links .nav-group:last-child {
        padding-right: 0;
      }

      .nav-links a {
        color: #0f172a;
        text-decoration: none;
        font-weight: 400;
        position: relative;
        padding: 4px 0;
        transition: all 0.3s ease;
        white-space: nowrap;
        opacity: 0.9; /* Slightly dimmed by default */
      }

      .nav-links a:hover {
        opacity: 1; /* Full opacity on hover */
      }

      .dark-mode .nav-links a {
        color: #f8fafc;
      }

      .nav-links a::after {
        content: "";
        position: absolute;
        width: 0;
        height: 2px;
        bottom: 0;
        left: 0;
        background-color: #2563eb;
        transition: width 0.3s ease;
      }

      .nav-links a:hover {
        color: #2563eb;
      }

      .nav-links a:hover::after {
        width: 100%;
      }

      /* Mobile menu styles */
      .mobile-menu-toggle {
        display: none;
        flex-direction: column;
        justify-content: space-between;
        width: 30px;
        height: 21px;
        cursor: pointer;
        z-index: 1001;
      }

      .mobile-menu-toggle span {
        display: block;
        height: 3px;
        width: 100%;
        background-color: currentColor;
        border-radius: 3px;
        transition: all 0.3s ease;
      }

      .mobile-menu-toggle.active span:nth-child(1) {
        transform: translateY(9px) rotate(45deg);
      }

      .mobile-menu-toggle.active span:nth-child(2) {
        opacity: 0;
      }

      .mobile-menu-toggle.active span:nth-child(3) {
        transform: translateY(-9px) rotate(-45deg);
      }

      .mobile-nav {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background: var(--bg);
        z-index: 1000;
        padding-top: 70px;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        overflow-y: auto;
      }

      .mobile-nav.active {
        transform: translateX(0);
        display: block;
      }

      .mobile-nav .nav-links {
        flex-direction: column;
        align-items: flex-start;
        padding: 20px;
        gap: 20px;
      }

      .mobile-nav .nav-group {
        flex-direction: column;
        align-items: flex-start;
        width: 100%;
        padding: 0 !important;
        gap: 15px !important;
        margin-bottom: 15px;
      }

      .mobile-nav .nav-group:not(:last-child)::after {
        content: "";
        position: relative;
        width: 100%;
        height: 1px;
        background: currentColor;
        opacity: 0.1;
        margin: 10px 0;
        transform: none;
      }

      .mobile-nav .nav-links a {
        font-size: 1.1rem;
        padding: 8px 0;
      }

      /* Media Queries */
      @media (max-width: 768px) {
        .nav-right .nav-links {
          display: none;
        }

        .mobile-menu-toggle {
          display: flex;
        }

        .mobile-nav {
          display: block;
        }

        .navbar {
          padding: 10px 20px;
        }

        .navbar.scrolled {
          padding-left: 20px;
          padding-right: 20px;
        }

        .nav-right {
          gap: 1rem;
        }
      }

      /* Toggle Switch Styles */
      .theme-toggle-container {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .theme-toggle-label {
        display: inline-block;
        font-size: 0.875rem;
        font-weight: 500;
        color: currentColor;
      }

      /* From Uiverse.io by satyamchaudharydev */
      /* The switch - the box around the slider */
      .toggle-switch {
        display: block;
        --width-of-switch: 3.5em;
        --height-of-switch: 2em;
        /* size of sliding icon -- sun and moon */
        --size-of-icon: 1.4em;
        /* it is like a inline-padding of switch */
        --slider-offset: 0.3em;
        position: relative;
        width: var(--width-of-switch);
        height: var(--height-of-switch);
      }

      /* Hide default HTML checkbox */
      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      /* The slider */
      .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #f4f4f5;
        transition: 0.4s;
        border-radius: 30px;
      }

      .toggle-slider:before {
        position: absolute;
        content: "";
        height: var(--size-of-icon, 1.4em);
        width: var(--size-of-icon, 1.4em);
        border-radius: 20px;
        left: var(--slider-offset, 0.3em);
        top: 50%;
        transform: translateY(-50%);
        background: linear-gradient(40deg, #ff0080, #ff8c00 70%);
        transition: 0.4s;
      }

      input:checked + .toggle-slider {
        background-color: #303136;
      }

      input:checked + .toggle-slider:before {
        left: calc(
          100% - (var(--size-of-icon, 1.4em) + var(--slider-offset, 0.3em))
        );
        background: #303136;
        /* change the value of second inset in box-shadow to change the angle and direction of the moon  */
        box-shadow: inset -3px -2px 5px -2px #8983f7,
          inset -10px -4px 0 0 #a3dafb;
      }

      /* Content area */
      .content {
        margin-top: 80px;
        padding: 10px;
        text-align: center;
      }

      .scrolled-image-container {
        width: 100%;
        margin-top: 20px;
        border-radius: 10px;
        overflow: hidden;
        background-color: white;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .scrolled-image-container img {
        width: 100%;
        height: auto;
        object-fit: contain;
      }

      .hidden {
        display: none !important;
      }

      /* Styles for shades and tints */
      #shadesContainer,
      #tintsContainer {
        display: flex;
        flex-wrap: nowrap;
        overflow-x: auto;
        gap: 0;
        padding: 0.5rem 0;
        scroll-behavior: smooth;
      }

      .shade-item,
      .tint-item {
        flex: 1;
        min-width: 30px;
        transition: all 0.3s ease;
        position: relative;
      }

      .shade-item .color-box,
      .tint-item .color-box {
        height: 40px;
        border-radius: 0;
        margin: 0;
        transition: all 0.3s ease;
        position: relative;
      }

      .shade-item:hover,
      .tint-item:hover {
        flex-grow: 3;
      }

      .shade-item:hover .color-box,
      .tint-item:hover .color-box {
        border-radius: 4px;
        transform: scale(1.05);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }

      .shade-item .color-info,
      .tint-item .color-info {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity 0.3s ease;
        background: rgba(255, 255, 255, 0.25);
        backdrop-filter: blur(4px);
        border-radius: 4px;
      }

      /* Adding specific styling for tint items to ensure text visibility */
      .tint-item .color-info {
        color: #000;
        font-weight: 600;
        text-shadow: 0px 0px 3px rgba(255, 255, 255, 0.7);
        background: rgba(255, 255, 255, 0.4);
      }

      .shade-item:hover .color-info,
      .tint-item:hover .color-info {
        opacity: 1;
      }

      /* Custom scrollbar styling */
      /* ... existing code ... */

      /* Magnifier styling */
      .magnifier {
        border-radius: 50%;
        width: 120px;
        height: 120px;
        position: absolute;
        border: 2px solid #3b82f6;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
        display: none;
        pointer-events: none;
        transform: translate(-50%, -50%);
        background-repeat: no-repeat;
        z-index: 9999;
      }

      /* Live color preview styling */
      #liveColorPreview {
        position: absolute;
        background-color: white;
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        padding: 0.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 10000;
        pointer-events: none;
        transition: transform 0.1s ease-out, opacity 0.2s ease;
        opacity: 0;
      }

      #liveColorPreview.hidden {
        display: none;
        opacity: 0;
      }

      #liveColorPreview:not(.hidden) {
        display: block;
        opacity: 1;
      }

      @media (prefers-color-scheme: dark) {
        #liveColorPreview {
          background-color: #1f2937;
          border-color: #4b5563;
        }
      }

      /* Color Palette Custom Styles */
      .card {
        width: 320px;
        height: 220px;
        perspective: 1000px;
        background: #fff;
        border-radius: 10px;
        box-shadow: 1px 1px 20px #c7c7c7;
      }

      .card .paleta {
        width: 100%;
        height: 180px;
        position: absolute;
        bottom: 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .component {
        height: 23px;
      }

      .card .paleta .cores {
        width: 80px;
        height: 180px;
        cursor: pointer;
        transition: 0.3s linear;
        overflow: hidden;
      }

      .card .paleta .cores:hover {
        width: 120px;
        transition: 0.4s linear;
      }

      .circle {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: #fff;
        position: absolute;
        top: -60px;
        box-shadow: 1px 1px 8px #c7c7c7;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .card .paleta .cor1 {
        border-radius: 0px 0px 0px 10px;
      }

      .card .paleta .cor4 {
        border-radius: 0px 0px 10px 0px;
      }

      .card .paleta .cores .nome {
        width: 100%;
        height: 30px;
        background-color: #fff;
        text-align: center;
        font-size: 11px;
        font-family: Roboto, sans-serif;
        font-weight: 550;
      }

      .card .paleta .func {
        width: 100px;
        display: block;
        transform: rotate(-90deg);
        position: absolute;
        bottom: 40px;
        margin-left: -41px;
        padding-left: 5px;
        color: #fff;
        font-size: 15px;
        font-family: sans-serif;
        font-weight: 500;
      }

      .div1,
      .div3,
      .div5,
      .div7 {
        cursor: pointer;
        transition: background-color 0.3s;
        position: absolute;
        bottom: 0;
        width: 80px;
        height: 150px;
      }

      .div2,
      .div4,
      .div6,
      .div8 {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: #fff;
        position: absolute;
        top: -60px;
        left: 135px;
        box-shadow: 1px 1px 8px #c7c7c7;
        align-items: center;
        justify-content: center;
        display: none;
      }

      .div1:hover + .div2,
      .div3:hover + .div4,
      .div5:hover + .div6,
      .div7:hover + .div8 {
        display: flex;
        animation: cssAnimation_0 1512ms 1 ease-out;
      }

      @keyframes cssAnimation_0 {
        to {
          transform: rotate(360deg) translate(0px, 0px);
        }
      }

      /* Dark mode adjustments for the palette */
      @media (prefers-color-scheme: dark) {
        .card {
          background: #1f2937;
          box-shadow: 1px 1px 20px #111827;
        }

        .card .paleta .cores .nome {
          background-color: #374151;
          color: #f3f4f6;
        }

        .circle,
        .div2,
        .div4,
        .div6,
        .div8 {
          background-color: #374151;
          box-shadow: 1px 1px 8px #111827;
          color: #f3f4f6;
        }
      }

      /* Color Palette Styles */
      .card .paleta .cores .nome {
        width: 100%;
        height: 30px;
        background-color: #fff;
        text-align: center;
        font-size: 11px;
        font-family: Roboto, sans-serif;
        font-weight: 550;
      }

      .card .paleta .func {
        width: 100px;
        display: block;
        transform: rotate(-90deg);
        position: absolute;
        bottom: 40px;
        margin-left: -41px;
        padding-left: 5px;
        color: #fff;
        font-size: 15px;
        font-family: sans-serif;
        font-weight: 500;
      }

      .div1,
      .div3,
      .div5,
      .div7 {
        cursor: pointer;
        transition: background-color 0.3s;
        position: absolute;
        bottom: 0;
        width: 80px;
        height: 150px;
      }

      .div2,
      .div4,
      .div6,
      .div8 {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: #fff;
        position: absolute;
        top: -60px;
        left: 135px;
        box-shadow: 1px 1px 8px #c7c7c7;
        align-items: center;
        justify-content: center;
        display: none;
      }

      .div1:hover + .div2,
      .div3:hover + .div4,
      .div5:hover + .div6,
      .div7:hover + .div8 {
        display: flex;
        color: #fff;
        animation: cssAnimation_0 1512ms 1 ease-out;
      }

      @keyframes cssAnimation_0 {
        to {
          transform: rotate(360deg) translate(0px, 0px);
        }
      }

      /* Dark mode adjustments */
      .dark .card {
        background: #1a1a1a;
        box-shadow: 1px 1px 20px #000;
      }

      .dark .circle {
        background-color: #1a1a1a;
        box-shadow: 1px 1px 8px #000;
      }

      .dark .card .paleta .cores .nome {
        background-color: #1a1a1a;
        color: #fff;
      }

      .dark .div2,
      .dark .div4,
      .dark .div6,
      .dark .div8 {
        background-color: #1a1a1a;
        box-shadow: 1px 1px 8px #000;
      }

      /* Custom Palette Style (from Uiverse.io by arshshaikh06) */
      .uiverse-palette-container {
        height: 200px;
        width: 350px;
        border-radius: 1em;
        overflow: hidden;
        box-shadow: 0 10px 20px #dbdbdb;
        font-family: sans-serif;
        background: white;
      }
      .dark-mode .uiverse-palette-container {
        background: #1f2937;
        box-shadow: 0 10px 20px #111827;
      }
      .uiverse-palette {
        display: flex;
        height: 86%;
        width: 100%;
      }
      .uiverse-color {
        height: 100%;
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        letter-spacing: 1px;
        transition: flex 0.1s linear;
        cursor: pointer;
      }
      .uiverse-color span {
        opacity: 0;
        transition: opacity 0.1s linear;
        font-family: monospace;
        font-size: 1rem;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
      }
      .uiverse-color:hover {
        flex: 2;
        box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
        z-index: 10;
      }
      .uiverse-color:hover span {
        opacity: 1;
      }
      .uiverse-palette-stats {
        height: 14%;
        width: 100%;
        background: white;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 1.5em;
        box-sizing: border-box;
        color: #bebebe;
      }
      .dark-mode .uiverse-palette-stats {
        background: #1f2937;
        color: #d1d5db;
      }
      .uiverse-palette-stats svg {
        fill: #bebebe;
        transform: scale(1.2);
      }
      .dark-mode .uiverse-palette-stats svg {
        fill: #d1d5db;
      }

      /* Hide scrollbars but keep scrolling functionality */
      .w-full.md\:w-2\/3.lg\:w-3\/4.overflow-auto::-webkit-scrollbar,
      .left-column::-webkit-scrollbar,
      .right-column::-webkit-scrollbar {
        width: 0; /* Remove scrollbar width */
        background: transparent; /* Optional: make scrollbar transparent */
        display: none; /* Extra safety to ensure it's hidden */
      }

      /* Firefox */
      .w-full.md\:w-2\/3.lg\:w-3\/4.overflow-auto,
      .left-column,
      .right-column {
        scrollbar-width: none; /* Hide scrollbar in Firefox */
      }

      /* IE and Edge */
      .w-full.md\:w-2\/3.lg\:w-3\/4.overflow-auto,
      .left-column,
      .right-column {
        -ms-overflow-style: none; /* Hide scrollbar in IE and Edge */
      }

      .text-with-shadow-light {
        text-shadow: 0 0 2px #fff, 0 0 4px #fff, 0 0 6px #fff;
      }

      .text-with-shadow-dark {
        text-shadow: 0 0 2px #000, 0 0 4px #000, 0 0 6px #000;
      }

      /* Color Combinations Section */
      .color-square {
        transition: all 0.2s ease;
        position: relative;
        flex: 1;
      }

      .color-square:hover {
        transform: scale(1.02);
        z-index: 5;
        box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.4);
      }

      #colorCombinationsContainer .flex {
        display: flex;
        min-height: 55px;
        align-items: stretch;
        justify-content: stretch;
      }

      /* Color combination cards */
      #colorCombinationsContainer .bg-gray-50 {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        padding-top: 8px; /* Add extra padding at the top of each card */
        overflow: visible; /* Allow elements to overflow */
      }

      #colorCombinationsContainer .bg-gray-50:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      }

      /* Make more space for the base label */
      #colorCombinationsContainer .pt-2 {
        padding-top: 20px;
        margin-top: 8px;
        position: relative;
      }

      /* Add a semi-transparent checkerboard pattern for light colors */
      .color-square::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: linear-gradient(
            45deg,
            rgba(0, 0, 0, 0.03) 25%,
            transparent 25%
          ),
          linear-gradient(-45deg, rgba(0, 0, 0, 0.03) 25%, transparent 25%),
          linear-gradient(45deg, transparent 75%, rgba(0, 0, 0, 0.03) 75%),
          linear-gradient(-45deg, transparent 75%, rgba(0, 0, 0, 0.03) 75%);
        background-size: 10px 10px;
        background-position: 0 0, 0 5px, 5px -5px, -5px 0px;
        opacity: 0.5;
        pointer-events: none;
      }

      /* Color History Styles */
      .color-history-item {
        aspect-ratio: 1;
        border-radius: 0.375rem;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
        border: 1px solid rgba(0, 0, 0, 0.1);
      }

      .color-history-item:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 10;
      }

      .dark-mode .color-history-item {
        border-color: rgba(255, 255, 255, 0.1);
      }

      .dark-mode .color-history-item:hover {
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      }
    </style>

    <!-- Import modules -->
    <script type="module">
      import {
        hexToRgb,
        rgbToHsl,
        rgbToHsv,
        rgbToCmyk,
        colorHistory,
      } from "./js/colorUtils.js";
      import { initTouchColorPicker } from "./js/touchInteractions.js";

      // Initialize touch interactions
      initTouchColorPicker((x, y) => {
        // Use existing pickColor function
        pickColor(x, y);
      });

      // Make colorHistory available globally
      window.colorHistory = colorHistory;

      // Update the existing selectColor function to use colorHistory
      const originalSelectColor = window.selectColor;
      window.selectColor = function (color, skipCopy = false) {
        // Call the original function
        originalSelectColor(color, skipCopy);

        // Add to history
        colorHistory.add(color);
      };
    </script>
    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-GSMXWF15GP"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-GSMXWF15GP");
    </script>
    <!-- Google AdSense Verification -->
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8219399801950643"
      crossorigin="anonymous"
    ></script>
  </head>
  <body class="bg-gray-50 dark:bg-gray-900">
    <!-- Add error banner at the top of the body -->
    <div
      id="backendErrorBanner"
      class="hidden fixed top-0 left-0 w-full bg-red-600 text-white text-center py-2 z-50"
      role="alert"
      aria-live="assertive"
    >
      <span>Cannot connect to backend server. Please try again later.</span>
    </div>
    <div class="navbar-container">
      <div class="navbar">
        <div class="logo">
          <img
            src="assets/logo.svg"
            alt="ColorPeek Logo"
            width="30"
            height="30"
          />
          <span class="dynamic-contrast">ColorPeek</span>
        </div>
        <div class="nav-right">
          <div class="nav-links">
            <div class="nav-group">
              <a href="#" class="dynamic-contrast" aria-label="Home page"
                >Home</a
              >
              <a
                href="about.html"
                class="dynamic-contrast"
                aria-label="About page"
                >About</a
              >
              <a href="faq.html" class="dynamic-contrast" aria-label="FAQ page"
                >FAQ</a
              >
              <a
                href="contact.html"
                class="dynamic-contrast"
                aria-label="Contact page"
                >Contact</a
              >
              <a
                href="blog.html"
                class="dynamic-contrast"
                aria-label="Blog page"
                >Blog</a
              >
            </div>
            <div class="nav-group">
              <a
                href="#keyboard-shortcuts"
                class="dynamic-contrast"
                aria-label="View keyboard shortcuts"
                >Shortcuts</a
              >
              <a
                href="#how-it-works"
                class="dynamic-contrast"
                aria-label="Learn how to use ColorPeek"
                >Help</a
              >
            </div>
          </div>

          <label class="toggle-switch" aria-label="Toggle dark mode">
            <input type="checkbox" id="themeToggle" />
            <span class="toggle-slider"></span>
          </label>

          <!-- Mobile Menu Toggle Button -->
          <div
            class="mobile-menu-toggle"
            id="mobileMenuToggle"
            aria-label="Toggle mobile menu"
          >
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </div>
    <!-- Mobile Navigation Menu -->
    <div class="mobile-nav" id="mobileNav">
      <div class="nav-links">
        <div class="nav-group">
          <a href="#" class="dynamic-contrast" aria-label="Home page">Home</a>
          <a href="about.html" class="dynamic-contrast" aria-label="About page"
            >About</a
          >
          <a href="faq.html" class="dynamic-contrast" aria-label="FAQ page"
            >FAQ</a
          >
          <a
            href="contact.html"
            class="dynamic-contrast"
            aria-label="Contact page"
            >Contact</a
          >
        </div>
        <div class="nav-group">
          <a
            href="#keyboard-shortcuts"
            class="dynamic-contrast"
            aria-label="View keyboard shortcuts"
            >Shortcuts</a
          >
          <a
            href="#how-it-works"
            class="dynamic-contrast"
            aria-label="Learn how to use ColorPeek"
            >Help</a
          >
        </div>
      </div>
    </div>
    <div class="content">
      <!-- Main content with sidebar layout -->
      <div class="container mx-auto px-4 py-2 mt-10">
        <!-- SEO-friendly header section -->
        <header class="mb-8 text-center hidden md:block">
          <h1 class="text-3xl font-bold mb-2 text-gray-900 dark:text-white">
            Extract Colors from Images | Free Color Palette Generator
          </h1>
          <p class="text-gray-600 dark:text-gray-400 max-w-3xl mx-auto">
            Upload any image to identify dominant colors, get HEX codes, RGB
            values, and create professional color palettes for your design
            projects.
          </p>
        </header>

        <div class="flex flex-col md:flex-row gap-6 relative">
          <!-- Left sidebar with image display and upload controls -->
          <div
            class="w-full md:w-1/2 lg:w-1/3 md:sticky md:top-24 md:h-[calc(100vh-6rem)]"
          >
            <!-- Image Display Section - Moved above upload section -->
            <div
              id="mainImageContainer"
              class="mb-3 w-full relative"
              style="background: none"
            >
              <img
                id="mainImageDisplay"
                src="assets/color-peek-default.jpg"
                alt="Image Display"
                class="w-full h-[320px] object-contain rounded-sm shadow-lg"
                style="
                  background: var(--bg);
                  transition: background-color 0.3s ease;
                "
              />
              <div
                id="magnifier"
                class="hidden absolute w-[120px] h-[120px] border-2 border-blue-500 rounded-full overflow-hidden pointer-events-none shadow-lg"
                style="z-index: 9999"
              >
                <!-- Canvas for magnified view -->
                <canvas id="magnifierCanvas" width="120" height="120"></canvas>
              </div>

              <!-- Live color preview separated from the magnifier to move independently -->
              <div
                id="liveColorPreview"
                class="hidden absolute bg-white dark:bg-gray-800 px-2 py-1 rounded shadow-md border border-gray-300 dark:border-gray-600"
                style="width: 130px; z-index: 10000; pointer-events: none"
              >
                <div class="flex flex-col items-start">
                  <div class="flex items-center gap-2">
                    <div
                      id="liveColorBox"
                      class="w-6 h-6 rounded border border-gray-300 dark:border-gray-600"
                      style="background-color: #cccccc"
                    ></div>
                    <span
                      id="liveColorHex"
                      class="text-xs font-mono font-medium text-gray-900 dark:text-white"
                    ></span>
                  </div>
                </div>
              </div>
              <div
                id="colorInfo"
                class="hidden absolute bg-white dark:bg-gray-800 text-gray-900 dark:text-white text-sm py-1 px-2 rounded shadow-md pointer-events-none flex items-center gap-2"
                style="z-index: 10000"
              >
                <div
                  id="colorBox"
                  class="w-4 h-4 rounded border border-gray-300 dark:border-gray-600"
                ></div>
                <span id="colorHex"></span>
              </div>
            </div>

            <!-- Upload Controls Section -->
            <div
              class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden mb-3"
            >
              <div class="border-b border-gray-200 dark:border-gray-700">
                <div class="flex">
                  <button
                    id="deviceUploadTab"
                    class="px-4 py-3 w-1/2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-800 border-b-2 border-blue-600 dark:border-blue-400 focus:outline-none"
                    onclick="switchTab('device')"
                  >
                    Device
                  </button>
                  <button
                    id="urlUploadTab"
                    class="px-4 py-3 w-1/2 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none"
                    onclick="switchTab('url')"
                  >
                    URL
                  </button>
                </div>
              </div>

              <!-- Device Upload Section -->
              <div id="deviceUploadSection" class="p-4">
                <div class="mb-2">
                  <label
                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                    for="imageInput"
                  >
                    Upload Image
                  </label>
                  <div
                    class="mt-1 flex justify-center px-4 pt-3 pb-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-md hover:border-gray-400 dark:hover:border-gray-500 transition-colors cursor-pointer"
                    id="dropZone"
                  >
                    <div class="space-y-1 text-center">
                      <svg
                        class="mx-auto h-8 w-8 text-gray-400"
                        stroke="currentColor"
                        fill="none"
                        viewBox="0 0 48 48"
                        aria-hidden="true"
                      >
                        <path
                          d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        />
                      </svg>
                      <div
                        class="flex text-sm text-gray-600 dark:text-gray-400"
                      >
                        <label
                          for="imageInput"
                          class="relative cursor-pointer rounded-md font-medium text-blue-600 dark:text-blue-400 hover:text-blue-500 focus-within:outline-none"
                        >
                          <span>Upload a file</span>
                          <input
                            id="imageInput"
                            name="imageInput"
                            type="file"
                            accept="image/png,image/jpeg"
                            class="sr-only"
                            onchange="previewImage(this)"
                          />
                        </label>
                        <p class="pl-1">or drag and drop</p>
                      </div>
                      <p class="text-xs text-gray-500 dark:text-gray-400">
                        PNG, JPG up to 10MB
                      </p>
                    </div>
                  </div>
                </div>

                <div
                  id="errorMessage"
                  class="hidden text-sm text-red-600 dark:text-red-400 mb-2"
                ></div>

                <button
                  id="extractButton"
                  class="cursor-pointer text-white font-bold relative text-[14px] w-full h-[2.75em] text-center bg-gradient-to-r from-violet-500 from-10% via-sky-500 via-30% to-pink-500 to-90% bg-[length:400%] rounded-[30px] z-10 hover:animate-gradient-xy hover:bg-[length:100%] before:content-[''] before:-top-[5px] before:-bottom-[5px] before:-left-[5px] before:-right-[5px] before:bg-gradient-to-r before:from-violet-500 before:from-10% before:via-sky-500 before:via-30% before:to-pink-500 before:bg-[length:400%] before:-z-10 before:rounded-[35px] before:hover:blur-xl before:transition-all before:ease-in-out before:duration-[1s] before:hover:bg-[length:10%] active:bg-violet-700 focus:ring-violet-700"
                  onclick="triggerFileUpload()"
                >
                  <div
                    id="loaderContainer"
                    class="hidden absolute left-1/4 flex items-center justify-center"
                  >
                    <svg
                      class="animate-spin h-5 w-5 text-white"
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                    >
                      <circle
                        class="opacity-25"
                        cx="12"
                        cy="12"
                        r="10"
                        stroke="currentColor"
                        stroke-width="4"
                      ></circle>
                      <path
                        class="opacity-75"
                        fill="currentColor"
                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                      ></path>
                    </svg>
                  </div>
                  <span id="buttonText">Upload Image</span>
                </button>
              </div>

              <!-- URL Upload Section -->
              <div id="urlUploadSection" class="p-4 hidden">
                <div class="mb-2">
                  <label
                    for="imageUrl"
                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >
                    Image URL
                  </label>
                  <input
                    type="text"
                    id="imageUrl"
                    name="imageUrl"
                    class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md p-2"
                    placeholder="https://example.com/image.jpg"
                  />
                </div>

                <button
                  id="fetchUrlButton"
                  class="cursor-pointer text-white font-bold relative text-[14px] w-full h-[3em] text-center bg-gradient-to-r from-violet-500 from-10% via-sky-500 via-30% to-pink-500 to-90% bg-[length:400%] rounded-[30px] z-10 hover:animate-gradient-xy hover:bg-[length:100%] before:content-[''] before:-top-[5px] before:-bottom-[5px] before:-left-[5px] before:-right-[5px] before:bg-gradient-to-r before:from-violet-500 before:from-10% before:via-sky-500 before:via-30% before:to-pink-500 before:bg-[length:400%] before:-z-10 before:rounded-[35px] before:hover:blur-xl before:transition-all before:ease-in-out before:duration-[1s] before:hover:bg-[length:10%] active:bg-violet-700 focus:ring-violet-700"
                  onclick="fetchImageFromUrl()"
                >
                  <div
                    id="urlLoaderContainer"
                    class="hidden absolute left-1/4 flex items-center justify-center"
                  >
                    <svg
                      class="animate-spin h-5 w-5 text-white"
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                    >
                      <circle
                        class="opacity-25"
                        cx="12"
                        cy="12"
                        r="10"
                        stroke="currentColor"
                        stroke-width="4"
                      ></circle>
                      <path
                        class="opacity-75"
                        fill="currentColor"
                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                      ></path>
                    </svg>
                  </div>
                  <span id="urlButtonText">Fetch Image</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Main content area - Right side -->
          <div class="w-full md:w-2/3 lg:w-3/4">
            <!-- Extracted Colors Section -->
            <div
              id="extractedColorsContainer"
              class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden hidden mb-3 shadow-md overflow-hidden transition-all hover:shadow-lg"
            >
              <div
                class="p-3 border-b border-gray-200 dark:border-gray-700 flex items-center"
              >
                <div class="h-4 w-1 bg-blue-500 rounded mr-2"></div>
                <h2
                  class="text-base font-medium text-gray-900 dark:text-white flex items-center"
                >
                  <svg
                    class="w-4 h-4 mr-2 text-gray-600 dark:text-gray-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"
                    ></path>
                  </svg>
                  <span class="gradient-text">Extracted Colors</span>
                </h2>
              </div>
              <!-- Color palette will be inserted here by JavaScript -->
            </div>

            <!-- Detailed Color Information Section -->
            <div
              id="colorDetailsContainer"
              class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden mb-6 shadow-md transition-all hover:shadow-lg"
            >
              <div
                class="p-3 border-b border-gray-200 dark:border-gray-700 flex items-center"
              >
                <div class="h-4 w-1 bg-blue-500 rounded mr-2"></div>
                <h2
                  class="text-base font-medium text-gray-900 dark:text-white flex items-center"
                >
                  <svg
                    class="w-4 h-4 mr-2 text-gray-600 dark:text-gray-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"
                    ></path>
                  </svg>
                  <span class="gradient-text">Color Details</span>
                </h2>
              </div>
              <div class="p-4">
                <!-- Color Details Container -->
                <div class="grid grid-cols-1 md:grid-cols-5 gap-6">
                  <!-- Left Column (1/5): Color Preview and Usage Examples -->
                  <div class="md:col-span-1 space-y-6">
                    <!-- Color Preview Box -->
                    <div
                      class="bg-white dark:bg-gray-800 p-4 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm"
                    >
                      <div class="flex flex-col items-center">
                        <div
                          id="selectedColorBox"
                          class="w-24 h-24 rounded-lg mb-3 shadow-md cursor-pointer group relative hover:shadow-lg transition-shadow duration-300"
                          style="background-color: #cccccc"
                          onclick="copyToClipboard(document.getElementById('hexValue').textContent)"
                        >
                          <!-- Hex value inside the color box -->
                          <div
                            class="absolute inset-0 flex items-center justify-center"
                          >
                            <span
                              id="hexValue"
                              class="text-lg font-bold font-mono cursor-pointer backdrop-blur-sm px-2 py-1 rounded"
                              onclick="copyToClipboard(this.textContent)"
                              >#CCCCCC</span
                            >
                          </div>
                          <div
                            class="absolute inset-0 flex items-center justify-center bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity duration-200 rounded-lg"
                          >
                            <span
                              class="text-white text-xs px-2 py-1 bg-black/50 rounded"
                              >Click to copy</span
                            >
                          </div>
                        </div>
                        <div class="mt-2">
                          <span
                            id="colorName"
                            class="inline-block min-w-[80px] px-3 py-1 text-sm font-semibold text-gray-800 dark:text-gray-100 bg-white/70 dark:bg-gray-900/70 rounded-full shadow-sm text-center opacity-0 transition-opacity duration-300"
                          ></span>
                        </div>
                      </div>
                    </div>

                    <!-- Color History -->
                    <div
                      class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden"
                    >
                      <div
                        class="px-3 py-2 bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"
                      >
                        <h3
                          class="text-sm font-medium text-gray-700 dark:text-gray-300"
                        >
                          Color History
                        </h3>
                      </div>
                      <div class="p-4">
                        <div id="colorHistory" class="grid grid-cols-5 gap-2">
                          <!-- Color history items will be added here dynamically -->
                        </div>
                      </div>
                    </div>

                    <!-- Color Usage Examples -->
                    <div
                      class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden"
                    >
                      <div
                        class="px-3 py-2 bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"
                      >
                        <h3
                          class="text-sm font-medium text-gray-700 dark:text-gray-300"
                        >
                          Color Usage Examples
                        </h3>
                      </div>
                      <div class="p-4 space-y-3">
                        <div>
                          <div
                            id="exampleBg"
                            class="h-12 rounded border border-gray-200 dark:border-gray-700 flex items-center justify-center"
                            style="background-color: #cccccc"
                          >
                            <span class="text-sm"
                              ><b>Text on background</b></span
                            >
                          </div>
                        </div>
                        <div>
                          <div
                            class="h-12 bg-white dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700 flex items-center justify-center"
                          >
                            <span
                              id="exampleText"
                              class="text-sm"
                              style="color: #cccccc"
                              ><b>Sample Text</b></span
                            >
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Right Column (4/5): Color Models -->
                  <div class="md:col-span-4">
                    <div
                      class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden"
                    >
                      <div
                        class="px-4 py-2 bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"
                      >
                        <h3
                          class="text-sm font-medium text-gray-700 dark:text-gray-300"
                        >
                          Color Models
                        </h3>
                      </div>
                      <div class="p-4">
                        <!-- 2x2 Grid for color models -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                          <!-- RGB Model -->
                          <div id="content-rgb" class="color-model-section">
                            <h4
                              class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"
                            >
                              RGB
                            </h4>
                            <div class="space-y-3">
                              <!-- Red -->
                              <div>
                                <div
                                  class="flex justify-between items-center mb-1"
                                >
                                  <span
                                    class="text-sm font-medium text-gray-700 dark:text-gray-300"
                                    >Red</span
                                  >
                                  <span id="rgbR" class="font-mono text-sm"
                                    >204</span
                                  >
                                </div>
                                <div
                                  class="w-full h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"
                                >
                                  <div
                                    id="rgbRBar"
                                    class="h-full bg-red-500"
                                    style="width: 80%"
                                  ></div>
                                </div>
                              </div>
                              <!-- Green -->
                              <div>
                                <div
                                  class="flex justify-between items-center mb-1"
                                >
                                  <span
                                    class="text-sm font-medium text-gray-700 dark:text-gray-300"
                                    >Green</span
                                  >
                                  <span id="rgbG" class="font-mono text-sm"
                                    >204</span
                                  >
                                </div>
                                <div
                                  class="w-full h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"
                                >
                                  <div
                                    id="rgbGBar"
                                    class="h-full bg-green-500"
                                    style="width: 80%"
                                  ></div>
                                </div>
                              </div>
                              <!-- Blue -->
                              <div>
                                <div
                                  class="flex justify-between items-center mb-1"
                                >
                                  <span
                                    class="text-sm font-medium text-gray-700 dark:text-gray-300"
                                    >Blue</span
                                  >
                                  <span id="rgbB" class="font-mono text-sm"
                                    >204</span
                                  >
                                </div>
                                <div
                                  class="w-full h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"
                                >
                                  <div
                                    id="rgbBBar"
                                    class="h-full bg-blue-500"
                                    style="width: 80%"
                                  ></div>
                                </div>
                              </div>
                              <div class="mt-3 text-center">
                                <span
                                  class="text-xs text-gray-600 dark:text-gray-400 font-mono"
                                  >rgb(204, 204, 204)</span
                                >
                              </div>
                            </div>
                          </div>

                          <!-- HSL Model -->
                          <div id="content-hsl" class="color-model-section">
                            <h4
                              class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"
                            >
                              HSL
                            </h4>
                            <div class="space-y-3">
                              <!-- Hue -->
                              <div>
                                <div
                                  class="flex justify-between items-center mb-1"
                                >
                                  <span
                                    class="text-sm font-medium text-gray-700 dark:text-gray-300"
                                    >Hue</span
                                  >
                                  <span id="hslH" class="font-mono text-sm"
                                    >0</span
                                  >
                                </div>
                                <div
                                  class="w-full h-4 rounded-full overflow-hidden relative"
                                  style="
                                    background: linear-gradient(
                                      to right,
                                      #ff0000,
                                      #ffff00,
                                      #00ff00,
                                      #00ffff,
                                      #0000ff,
                                      #ff00ff,
                                      #ff0000
                                    );
                                  "
                                >
                                  <div
                                    id="hslHMarker"
                                    class="absolute top-0 w-1 h-4 bg-white border border-gray-700 dark:border-white"
                                    style="
                                      left: 0%;
                                      transform: translateX(-50%);
                                    "
                                  ></div>
                                </div>
                              </div>
                              <!-- Saturation -->
                              <div>
                                <div
                                  class="flex justify-between items-center mb-1"
                                >
                                  <span
                                    class="text-sm font-medium text-gray-700 dark:text-gray-300"
                                    >Saturation</span
                                  >
                                  <span id="hslS" class="font-mono text-sm"
                                    >0%</span
                                  >
                                </div>
                                <div
                                  class="w-full h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"
                                >
                                  <div
                                    id="hslSBar"
                                    class="h-full bg-blue-500"
                                    style="width: 0%"
                                  ></div>
                                </div>
                              </div>
                              <!-- Lightness -->
                              <div>
                                <div
                                  class="flex justify-between items-center mb-1"
                                >
                                  <span
                                    class="text-sm font-medium text-gray-700 dark:text-gray-300"
                                    >Lightness</span
                                  >
                                  <span id="hslL" class="font-mono text-sm"
                                    >80%</span
                                  >
                                </div>
                                <div
                                  class="w-full h-4 rounded-full overflow-hidden relative"
                                  style="
                                    background: linear-gradient(
                                      to right,
                                      #000000,
                                      #cccccc,
                                      #ffffff
                                    );
                                  "
                                >
                                  <div
                                    id="hslLMarker"
                                    class="absolute top-0 w-1 h-4 bg-white border border-gray-700 dark:border-white"
                                    style="
                                      left: 80%;
                                      transform: translateX(-50%);
                                    "
                                  ></div>
                                </div>
                              </div>
                              <div class="mt-3 text-center">
                                <span
                                  class="text-xs text-gray-600 dark:text-gray-400 font-mono"
                                  >hsl(0, 0%, 80%)</span
                                >
                              </div>
                            </div>
                          </div>

                          <!-- HSV Model -->
                          <div id="content-hsv" class="color-model-section">
                            <h4
                              class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"
                            >
                              HSV
                            </h4>
                            <div class="space-y-3">
                              <!-- Hue -->
                              <div>
                                <div
                                  class="flex justify-between items-center mb-1"
                                >
                                  <span
                                    class="text-sm font-medium text-gray-700 dark:text-gray-300"
                                    >Hue</span
                                  >
                                  <span id="hsvH" class="font-mono text-sm"
                                    >0</span
                                  >
                                </div>
                                <div
                                  class="w-full h-4 rounded-full overflow-hidden relative"
                                  style="
                                    background: linear-gradient(
                                      to right,
                                      #ff0000,
                                      #ffff00,
                                      #00ff00,
                                      #00ffff,
                                      #0000ff,
                                      #ff00ff,
                                      #ff0000
                                    );
                                  "
                                >
                                  <div
                                    id="hsvHMarker"
                                    class="absolute top-0 w-1 h-4 bg-white border border-gray-700 dark:border-white"
                                    style="
                                      left: 0%;
                                      transform: translateX(-50%);
                                    "
                                  ></div>
                                </div>
                              </div>
                              <!-- Saturation -->
                              <div>
                                <div
                                  class="flex justify-between items-center mb-1"
                                >
                                  <span
                                    class="text-sm font-medium text-gray-700 dark:text-gray-300"
                                    >Saturation</span
                                  >
                                  <span id="hsvS" class="font-mono text-sm"
                                    >0%</span
                                  >
                                </div>
                                <div
                                  class="w-full h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"
                                >
                                  <div
                                    id="hsvSBar"
                                    class="h-full bg-purple-500"
                                    style="width: 0%"
                                  ></div>
                                </div>
                              </div>
                              <!-- Value -->
                              <div>
                                <div
                                  class="flex justify-between items-center mb-1"
                                >
                                  <span
                                    class="text-sm font-medium text-gray-700 dark:text-gray-300"
                                    >Value</span
                                  >
                                  <span id="hsvV" class="font-mono text-sm"
                                    >80%</span
                                  >
                                </div>
                                <div
                                  class="w-full h-4 rounded-full overflow-hidden relative"
                                  style="
                                    background: linear-gradient(
                                      to right,
                                      #000000,
                                      #cccccc,
                                      #ffffff
                                    );
                                  "
                                >
                                  <div
                                    id="hsvVMarker"
                                    class="absolute top-0 w-1 h-4 bg-white border border-gray-700 dark:border-white"
                                    style="
                                      left: 80%;
                                      transform: translateX(-50%);
                                    "
                                  ></div>
                                </div>
                              </div>
                              <div class="mt-3 text-center">
                                <span
                                  class="text-xs text-gray-600 dark:text-gray-400 font-mono"
                                  >hsv(0, 0%, 80%)</span
                                >
                              </div>
                            </div>
                          </div>

                          <!-- CMYK Model -->
                          <div id="content-cmyk" class="color-model-section">
                            <h4
                              class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"
                            >
                              CMYK
                            </h4>
                            <div class="space-y-3">
                              <!-- Cyan -->
                              <div>
                                <div
                                  class="flex justify-between items-center mb-1"
                                >
                                  <span
                                    class="text-sm font-medium text-gray-700 dark:text-gray-300"
                                    >Cyan</span
                                  >
                                  <span id="cmykC" class="font-mono text-sm"
                                    >0%</span
                                  >
                                </div>
                                <div
                                  class="w-full h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"
                                >
                                  <div
                                    id="cmykCBar"
                                    class="h-full bg-cyan-500"
                                    style="width: 0%"
                                  ></div>
                                </div>
                              </div>
                              <!-- Magenta -->
                              <div>
                                <div
                                  class="flex justify-between items-center mb-1"
                                >
                                  <span
                                    class="text-sm font-medium text-gray-700 dark:text-gray-300"
                                    >Magenta</span
                                  >
                                  <span id="cmykM" class="font-mono text-sm"
                                    >0%</span
                                  >
                                </div>
                                <div
                                  class="w-full h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"
                                >
                                  <div
                                    id="cmykMBar"
                                    class="h-full bg-pink-500"
                                    style="width: 0%"
                                  ></div>
                                </div>
                              </div>
                              <!-- Yellow -->
                              <div>
                                <div
                                  class="flex justify-between items-center mb-1"
                                >
                                  <span
                                    class="text-sm font-medium text-gray-700 dark:text-gray-300"
                                    >Yellow</span
                                  >
                                  <span id="cmykY" class="font-mono text-sm"
                                    >0%</span
                                  >
                                </div>
                                <div
                                  class="w-full h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"
                                >
                                  <div
                                    id="cmykYBar"
                                    class="h-full bg-yellow-500"
                                    style="width: 0%"
                                  ></div>
                                </div>
                              </div>
                              <!-- Key (Black) -->
                              <div>
                                <div
                                  class="flex justify-between items-center mb-1"
                                >
                                  <span
                                    class="text-sm font-medium text-gray-700 dark:text-gray-300"
                                    >Key (Black)</span
                                  >
                                  <span id="cmykK" class="font-mono text-sm"
                                    >20%</span
                                  >
                                </div>
                                <div
                                  class="w-full h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"
                                >
                                  <div
                                    id="cmykKBar"
                                    class="h-full bg-gray-900"
                                    style="width: 20%"
                                  ></div>
                                </div>
                              </div>
                              <div class="mt-3 text-center">
                                <span
                                  class="text-xs text-gray-600 dark:text-gray-400 font-mono"
                                  >cmyk(0%, 0%, 0%, 20%)</span
                                >
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Color Variations Section -->
            <div
              id="colorVariationsContainer"
              class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden hidden mb-6 shadow-md overflow-hidden transition-all hover:shadow-lg"
            >
              <div
                class="p-3 border-b border-gray-200 dark:border-gray-700 flex items-center"
              >
                <div class="h-4 w-1 bg-blue-500 rounded mr-2"></div>
                <h2
                  class="text-base font-medium text-gray-900 dark:text-white flex items-center"
                >
                  <svg
                    class="w-4 h-4 mr-2 text-gray-600 dark:text-gray-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"
                    ></path>
                  </svg>
                  <span class="gradient-text">Color Variations</span>
                </h2>
              </div>
              <div class="p-4">
                <!-- Shades - Darker variations -->
                <div class="mb-6">
                  <h3
                    class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"
                  >
                    Shades
                  </h3>
                  <div class="relative">
                    <!-- Removed padding-top -->
                    <div id="shadesContainer" class="flex overflow-x-auto">
                      <!-- Shade items will be dynamically generated -->
                    </div>
                  </div>
                </div>

                <!-- Tints - Lighter variations -->
                <div>
                  <h3
                    class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"
                  >
                    Tints
                  </h3>
                  <div class="relative">
                    <!-- Removed padding-top -->
                    <div id="tintsContainer" class="flex overflow-x-auto">
                      <!-- Tint items will be dynamically generated -->
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Move Palette & Collage Section here, between Extracted Colors and Color Details, and ensure it is not re-appended in JS -->
            <div
              id="paletteCollageContainer"
              class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden hidden mb-6 shadow-md transition-all hover:shadow-lg"
            >
              <div
                class="p-3 border-b border-gray-200 dark:border-gray-700 flex items-center"
              >
                <div class="h-4 w-1 bg-blue-500 rounded mr-2"></div>
                <h2
                  class="text-base font-medium text-gray-900 dark:text-white flex items-center"
                >
                  <svg
                    class="w-4 h-4 mr-2 text-gray-600 dark:text-gray-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                    ></path>
                  </svg>
                  <span class="gradient-text"></span>Palette & Collage</span>
                </h2>
              </div>
              <div class="p-4">
                <div
                  class="flex flex-col md:flex-row gap-8 items-center justify-center"
                >
                  <!-- Left: Palette -->
                  <div>
                    <div
                      class="uiverse-palette-container"
                      id="uiversePaletteContainer"
                    >
                      <div class="uiverse-palette" id="uiversePalette"></div>
                      <div class="uiverse-palette-stats">
                        <span id="uiversePaletteStats">Palette from image</span>
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="18"
                          height="18"
                          viewBox="0 0 18 18"
                        >
                          <path
                            d="M4 7.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5S5.5 9.83 5.5 9 4.83 7.5 4 7.5zm10 0c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm-5 0c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5S9.83 7.5 9 7.5z"
                          ></path>
                        </svg>
                      </div>
                    </div>
                  </div>
                  <!-- Right: Collage (image and palette flush) -->
                  <div class="flex flex-col items-center">
                    <div
                      class="w-[220px] rounded-none overflow-hidden"
                      style="height: 140px"
                    >
                      <img
                        id="collageImage"
                        src="assets/default.jpg"
                        alt="Collage Image"
                        class="object-contain w-full h-full"
                      />
                    </div>
                    <div
                      class="uiverse-palette-container w-[220px] h-[48px]"
                      style="
                        height: 48px;
                        min-width: 180px;
                        max-width: 100%;
                        box-shadow: 0 4px 16px #dbdbdb;
                        border-radius: 0 0 1em 1em;
                        margin-top: 0;
                      "
                    >
                      <div
                        class="uiverse-palette h-full"
                        id="collagePalette"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Color Contrast Checker Section -->
            <div
              id="contrastCheckerContainer"
              class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden mb-6 shadow-md transition-all hover:shadow-lg"
            >
              <div
                class="p-3 border-b border-gray-200 dark:border-gray-700 flex items-center"
              >
                <div class="h-4 w-1 bg-blue-500 rounded mr-2"></div>
                <h2
                  class="text-base font-medium text-gray-900 dark:text-white flex items-center"
                >
                  <svg
                    class="w-4 h-4 mr-2 text-gray-600 dark:text-gray-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"
                    ></path>
                  </svg>
                  <span class="gradient-text">Contrast Checker</span>
                </h2>
              </div>
              <div class="p-4">
                <!-- Two-column layout -->
                <div class="flex flex-col md:flex-row gap-6">
                  <!-- Left side: Input controls -->
                  <div class="w-full md:w-1/2">
                    <!-- Text color input -->
                    <div class="mb-6">
                      <label
                        class="block text-gray-700 dark:text-gray-300 font-medium mb-2"
                      >
                        Text color
                      </label>
                      <div
                        class="flex rounded-lg border border-gray-300 overflow-hidden"
                      >
                        <input
                          type="text"
                          id="textColorInput"
                          value="#000000"
                          class="py-3 px-4 flex-grow text-sm focus:outline-none"
                          style="color: #000000"
                        />
                        <input
                          type="color"
                          id="textColorPicker"
                          value="#000000"
                          class="w-12 h-full cursor-pointer border-0 m-0 p-0"
                        />
                        <div
                          id="textColorPreview"
                          class="w-14 h-12 cursor-pointer border-l border-gray-300 flex items-center justify-center"
                          style="background-color: #000000"
                        >
                          <span
                            id="textColorPreviewText"
                            class="text-xs font-bold text-white"
                            >Aa</span
                          >
                        </div>
                      </div>
                    </div>

                    <!-- Background color input -->
                    <div class="mb-6">
                      <label
                        class="block text-gray-700 dark:text-gray-300 font-medium mb-2"
                      >
                        Background color
                      </label>
                      <div
                        class="flex rounded-lg border border-gray-300 overflow-hidden"
                      >
                        <input
                          type="text"
                          id="bgColorInput"
                          value="#ffffff"
                          class="py-3 px-4 flex-grow text-sm focus:outline-none"
                          style="color: #ffffff"
                        />
                        <input
                          type="color"
                          id="bgColorPicker"
                          value="#ffffff"
                          class="w-12 h-full cursor-pointer border-0 m-0 p-0"
                        />
                        <div
                          id="bgColorPreview"
                          class="w-14 h-12 cursor-pointer border-l border-gray-300 flex items-center justify-center"
                          style="background-color: #ffffff"
                        ></div>
                      </div>
                    </div>

                    <!-- Color preview and buttons -->
                    <div class="mb-6">
                      <label
                        class="block text-gray-700 dark:text-gray-300 font-medium mb-2"
                      >
                        Preview
                      </label>
                      <div
                        id="contrastPreview"
                        class="w-full h-24 rounded-lg border border-gray-300 flex items-center justify-center"
                        style="background-color: #ffffff"
                      >
                        <span style="color: #000000" class="text-md font-small">
                          <b id="previewTextInner"
                            >Now I am become Death, the destroyer of worlds"
                            <br />
                            - Bhagavad Gita Chapter 11, Verse 32
                          </b>
                        </span>
                      </div>
                    </div>

                    <div class="flex items-center gap-4 mb-6">
                      <button
                        id="swapColorsBtn"
                        class="px-3 py-2 bg-gray-200 dark:bg-gray-700 rounded-md text-sm hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
                      >
                        Swap Colors
                      </button>
                      <button
                        id="useSelectedColorBtn"
                        class="ml-2 px-3 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 transition-colors"
                      >
                        Use Selected Color
                      </button>
                    </div>
                  </div>

                  <!-- Right side: Results -->
                  <div class="w-full md:w-1/2">
                    <!-- Contrast results -->
                    <div
                      class="bg-green-50 dark:bg-green-900/20 rounded-lg p-6"
                    >
                      <div class="mb-4">
                        <p
                          class="text-gray-600 dark:text-gray-400 text-sm mb-1"
                        >
                          Contrast
                        </p>
                        <div class="flex items-end justify-between">
                          <div
                            class="text-5xl font-bold text-green-800 dark:text-green-400"
                            id="contrastRatio"
                          >
                            21.00
                          </div>
                          <div
                            class="text-green-800 dark:text-green-400 font-medium"
                            id="contrastRating"
                          >
                            Excellent
                          </div>
                        </div>
                        <div class="mt-1" id="contrastStars">
                          <span class="text-green-600 dark:text-green-400"
                            ></span
                          >
                          <span class="text-green-600 dark:text-green-400"
                            ></span
                          >
                          <span class="text-green-600 dark:text-green-400"
                            ></span
                          >
                          <span class="text-green-600 dark:text-green-400"
                            ></span
                          >
                          <span class="text-green-600 dark:text-green-400"
                            ></span
                          >
                        </div>
                      </div>

                      <div class="grid grid-cols-2 gap-8">
                        <!-- Small text -->
                        <div>
                          <p
                            class="text-sm text-gray-600 dark:text-gray-400 mb-2"
                          >
                            Small text
                          </p>
                          <div id="smallTextStars">
                            <span class="text-green-600 dark:text-green-400"
                              ></span
                            >
                            <span class="text-green-600 dark:text-green-400"
                              ></span
                            >
                            <span class="text-green-600 dark:text-green-400"
                              ></span
                            >
                          </div>
                        </div>

                        <!-- Large text -->
                        <div>
                          <p
                            class="text-sm text-gray-600 dark:text-gray-400 mb-2"
                          >
                            Large text
                          </p>
                          <div id="largeTextStars">
                            <span class="text-green-600 dark:text-green-400"
                              ></span
                            >
                            <span class="text-green-600 dark:text-green-400"
                              ></span
                            >
                            <span class="text-green-600 dark:text-green-400"
                              ></span
                            >
                          </div>
                        </div>
                      </div>

                      <div
                        class="mt-4 text-sm text-gray-600 dark:text-gray-400"
                      >
                        Good contrast for small text (below 18pt) and great
                        contrast for large text (above 18pt or bold above 14pt).
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Color Combinations Section -->
            <div
              id="colorCombinationsContainer"
              class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden mb-6 shadow-md transition-all hover:shadow-lg"
            >
              <div
                class="p-3 border-b border-gray-200 dark:border-gray-700 flex items-center"
              >
                <div class="h-4 w-1 bg-blue-500 rounded mr-2"></div>
                <h2
                  class="text-base font-medium text-gray-900 dark:text-white flex items-center"
                >
                  <svg
                    class="w-4 h-4 mr-2 text-gray-600 dark:text-gray-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
                    ></path>
                  </svg>
                  <span class="gradient-text">Color Harmony</span>
                </h2>
              </div>
              <div class="p-4">
                <!-- Color combination types - 2 column grid layout -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <!-- Complementary -->
                  <div
                    class="bg-gray-50 dark:bg-gray-800/50 p-3 rounded-lg relative"
                  >
                    <div class="flex justify-between items-center mb-1">
                      <h3
                        class="text-sm font-medium text-gray-700 dark:text-gray-300"
                      >
                        Complementary
                      </h3>
                    </div>
                    <p
                      class="text-xs text-gray-600 dark:text-gray-400 mb-2 line-clamp-2"
                    >
                      Two colors that are on opposite sides of the color wheel.
                    </p>
                    <div
                      id="complementaryColors"
                      class="flex justify-center pt-2"
                    >
                      <!-- Color squares will be added by JavaScript -->
                    </div>
                  </div>

                  <!-- Monochromatic -->
                  <div
                    class="bg-gray-50 dark:bg-gray-800/50 p-3 rounded-lg relative"
                  >
                    <div class="flex justify-between items-center mb-1">
                      <h3
                        class="text-sm font-medium text-gray-700 dark:text-gray-300"
                      >
                        Monochromatic
                      </h3>
                    </div>
                    <p
                      class="text-xs text-gray-600 dark:text-gray-400 mb-2 line-clamp-2"
                    >
                      Three shades, tones and tints of one base color.
                    </p>
                    <div
                      id="monochromaticColors"
                      class="flex justify-center pt-2"
                    >
                      <!-- Color squares will be added by JavaScript -->
                    </div>
                  </div>

                  <!-- Analogous -->
                  <div
                    class="bg-gray-50 dark:bg-gray-800/50 p-3 rounded-lg relative"
                  >
                    <div class="flex justify-between items-center mb-1">
                      <h3
                        class="text-sm font-medium text-gray-700 dark:text-gray-300"
                      >
                        Analogous
                      </h3>
                    </div>
                    <p
                      class="text-xs text-gray-600 dark:text-gray-400 mb-2 line-clamp-2"
                    >
                      Three colors that are side by side on the color wheel.
                    </p>
                    <div id="analogousColors" class="flex justify-center pt-2">
                      <!-- Color squares will be added by JavaScript -->
                    </div>
                  </div>

                  <!-- Triadic -->
                  <div
                    class="bg-gray-50 dark:bg-gray-800/50 p-3 rounded-lg relative"
                  >
                    <div class="flex justify-between items-center mb-1">
                      <h3
                        class="text-sm font-medium text-gray-700 dark:text-gray-300"
                      >
                        Triadic
                      </h3>
                    </div>
                    <p
                      class="text-xs text-gray-600 dark:text-gray-400 mb-2 line-clamp-2"
                    >
                      Three colors that are evenly spaced on the color wheel.
                    </p>
                    <div id="triadicColors" class="flex justify-center pt-2">
                      <!-- Color squares will be added by JavaScript -->
                    </div>
                  </div>

                  <!-- Tetradic -->
                  <div
                    class="bg-gray-50 dark:bg-gray-800/50 p-3 rounded-lg col-span-1 md:col-span-2 relative"
                  >
                    <div class="flex justify-between items-center mb-1">
                      <h3
                        class="text-sm font-medium text-gray-700 dark:text-gray-300"
                      >
                        Tetradic
                      </h3>
                    </div>
                    <p
                      class="text-xs text-gray-600 dark:text-gray-400 mb-2 line-clamp-2"
                    >
                      Four colors that are evenly spaced on the color wheel.
                    </p>
                    <div id="tetradicColors" class="flex justify-center pt-2">
                      <!-- Color squares will be added by JavaScript -->
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Code Snippets Section -->
            <div
              id="colorCodeSyntaxContainer"
              class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden mb-6 shadow-md transition-all hover:shadow-lg"
            >
              <div
                class="p-3 border-b border-gray-200 dark:border-gray-700 flex items-center"
              >
                <div class="h-4 w-1 bg-blue-500 rounded mr-2"></div>
                <h2
                  class="text-base font-medium text-gray-900 dark:text-white flex items-center"
                >
                  <svg
                    class="w-4 h-4 mr-2 text-gray-600 dark:text-gray-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"
                    ></path>
                  </svg>
                  <span class="gradient-text">Code Snippets</span>
                </h2>
              </div>
              <div class="p-4">
                <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">
                  Ready-to-use color code for developers in multiple programming
                  languages
                </p>

                <!-- Code snippets grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <!-- CSS -->
                  <div
                    class="bg-gray-50 dark:bg-gray-800/50 p-3 rounded-lg transition-shadow hover:shadow-md"
                  >
                    <div class="flex justify-between items-center">
                      <div class="flex items-center">
                        <div
                          class="w-3 h-3 rounded-full bg-red-500 mr-1.5"
                        ></div>
                        <div
                          class="w-3 h-3 rounded-full bg-yellow-500 mr-1.5"
                        ></div>
                        <div
                          class="w-3 h-3 rounded-full bg-green-500 mr-2"
                        ></div>
                        <h3
                          class="text-sm font-medium text-gray-700 dark:text-gray-300"
                        >
                          CSS
                        </h3>
                      </div>
                      <button
                        onclick="copyToClipboard(document.getElementById('cssSyntax').textContent)"
                        class="text-xs flex items-center text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-3.5 w-3.5 mr-1"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"
                          />
                        </svg>
                        Copy
                      </button>
                    </div>
                    <div
                      class="mt-3 bg-white dark:bg-gray-900 p-3 rounded font-mono text-xs overflow-x-auto border border-gray-100 dark:border-gray-800"
                    >
                      <code id="cssSyntax">color: #CCCCCC;</code>
                    </div>
                  </div>

                  <!-- HTML -->
                  <div
                    class="bg-gray-50 dark:bg-gray-800/50 p-3 rounded-lg transition-shadow hover:shadow-md"
                  >
                    <div class="flex justify-between items-center">
                      <div class="flex items-center">
                        <div
                          class="w-3 h-3 rounded-full bg-red-500 mr-1.5"
                        ></div>
                        <div
                          class="w-3 h-3 rounded-full bg-yellow-500 mr-1.5"
                        ></div>
                        <div
                          class="w-3 h-3 rounded-full bg-green-500 mr-2"
                        ></div>
                        <h3
                          class="text-sm font-medium text-gray-700 dark:text-gray-300"
                        >
                          HTML
                        </h3>
                      </div>
                      <button
                        onclick="copyToClipboard(document.getElementById('htmlSyntax').textContent)"
                        class="text-xs flex items-center text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-3.5 w-3.5 mr-1"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"
                          />
                        </svg>
                        Copy
                      </button>
                    </div>
                    <div
                      class="mt-3 bg-white dark:bg-gray-900 p-3 rounded font-mono text-xs overflow-x-auto border border-gray-100 dark:border-gray-800"
                    >
                      <code id="htmlSyntax"
                        >&lt;div style="color: #CCCCCC;"&gt;&lt;/div&gt;</code
                      >
                    </div>
                  </div>

                  <!-- JavaScript -->
                  <div
                    class="bg-gray-50 dark:bg-gray-800/50 p-3 rounded-lg transition-shadow hover:shadow-md"
                  >
                    <div class="flex justify-between items-center">
                      <div class="flex items-center">
                        <div
                          class="w-3 h-3 rounded-full bg-red-500 mr-1.5"
                        ></div>
                        <div
                          class="w-3 h-3 rounded-full bg-yellow-500 mr-1.5"
                        ></div>
                        <div
                          class="w-3 h-3 rounded-full bg-green-500 mr-2"
                        ></div>
                        <h3
                          class="text-sm font-medium text-gray-700 dark:text-gray-300"
                        >
                          JavaScript
                        </h3>
                      </div>
                      <button
                        onclick="copyToClipboard(document.getElementById('jsSyntax').textContent)"
                        class="text-xs flex items-center text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-3.5 w-3.5 mr-1"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"
                          />
                        </svg>
                        Copy
                      </button>
                    </div>
                    <div
                      class="mt-3 bg-white dark:bg-gray-900 p-3 rounded font-mono text-xs overflow-x-auto border border-gray-100 dark:border-gray-800"
                    >
                      <code id="jsSyntax"
                        >element.style.color = '#CCCCCC';</code
                      >
                    </div>
                  </div>

                  <!-- Android/Java -->
                  <div
                    class="bg-gray-50 dark:bg-gray-800/50 p-3 rounded-lg transition-shadow hover:shadow-md"
                  >
                    <div class="flex justify-between items-center">
                      <div class="flex items-center">
                        <div
                          class="w-3 h-3 rounded-full bg-red-500 mr-1.5"
                        ></div>
                        <div
                          class="w-3 h-3 rounded-full bg-yellow-500 mr-1.5"
                        ></div>
                        <div
                          class="w-3 h-3 rounded-full bg-green-500 mr-2"
                        ></div>
                        <h3
                          class="text-sm font-medium text-gray-700 dark:text-gray-300"
                        >
                          Android/Java
                        </h3>
                      </div>
                      <button
                        onclick="copyToClipboard(document.getElementById('androidSyntax').textContent)"
                        class="text-xs flex items-center text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-3.5 w-3.5 mr-1"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"
                          />
                        </svg>
                        Copy
                      </button>
                    </div>
                    <div
                      class="mt-3 bg-white dark:bg-gray-900 p-3 rounded font-mono text-xs overflow-x-auto border border-gray-100 dark:border-gray-800"
                    >
                      <code id="androidSyntax"
                        >int color = Color.parseColor("#CCCCCC");</code
                      >
                    </div>
                  </div>

                  <!-- Swift -->
                  <div
                    class="bg-gray-50 dark:bg-gray-800/50 p-3 rounded-lg transition-shadow hover:shadow-md"
                  >
                    <div class="flex justify-between items-center">
                      <div class="flex items-center">
                        <div
                          class="w-3 h-3 rounded-full bg-red-500 mr-1.5"
                        ></div>
                        <div
                          class="w-3 h-3 rounded-full bg-yellow-500 mr-1.5"
                        ></div>
                        <div
                          class="w-3 h-3 rounded-full bg-green-500 mr-2"
                        ></div>
                        <h3
                          class="text-sm font-medium text-gray-700 dark:text-gray-300"
                        >
                          Swift
                        </h3>
                      </div>
                      <button
                        onclick="copyToClipboard(document.getElementById('swiftSyntax').textContent)"
                        class="text-xs flex items-center text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-3.5 w-3.5 mr-1"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"
                          />
                        </svg>
                        Copy
                      </button>
                    </div>
                    <div
                      class="mt-3 bg-white dark:bg-gray-900 p-3 rounded font-mono text-xs overflow-x-auto border border-gray-100 dark:border-gray-800"
                    >
                      <code id="swiftSyntax"
                        >UIColor(red: 0.8, green: 0.8, blue: 0.8, alpha:
                        1.0)</code
                      >
                    </div>
                  </div>

                  <!-- Flutter/Dart -->
                  <div
                    class="bg-gray-50 dark:bg-gray-800/50 p-3 rounded-lg transition-shadow hover:shadow-md"
                  >
                    <div class="flex justify-between items-center">
                      <div class="flex items-center">
                        <div
                          class="w-3 h-3 rounded-full bg-red-500 mr-1.5"
                        ></div>
                        <div
                          class="w-3 h-3 rounded-full bg-yellow-500 mr-1.5"
                        ></div>
                        <div
                          class="w-3 h-3 rounded-full bg-green-500 mr-2"
                        ></div>
                        <h3
                          class="text-sm font-medium text-gray-700 dark:text-gray-300"
                        >
                          Flutter/Dart
                        </h3>
                      </div>
                      <button
                        onclick="copyToClipboard(document.getElementById('dartSyntax').textContent)"
                        class="text-xs flex items-center text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-3.5 w-3.5 mr-1"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"
                          />
                        </svg>
                        Copy
                      </button>
                    </div>
                    <div
                      class="mt-3 bg-white dark:bg-gray-900 p-3 rounded font-mono text-xs overflow-x-auto border border-gray-100 dark:border-gray-800"
                    >
                      <code id="dartSyntax">Color(0xFFCCCCCC)</code>
                    </div>
                  </div>

                  <!-- SCSS -->
                  <div
                    class="bg-gray-50 dark:bg-gray-800/50 p-3 rounded-lg transition-shadow hover:shadow-md"
                  >
                    <div class="flex justify-between items-center">
                      <div class="flex items-center">
                        <div
                          class="w-3 h-3 rounded-full bg-red-500 mr-1.5"
                        ></div>
                        <div
                          class="w-3 h-3 rounded-full bg-yellow-500 mr-1.5"
                        ></div>
                        <div
                          class="w-3 h-3 rounded-full bg-green-500 mr-2"
                        ></div>
                        <h3
                          class="text-sm font-medium text-gray-700 dark:text-gray-300"
                        >
                          SCSS
                        </h3>
                      </div>
                      <button
                        onclick="copyToClipboard(document.getElementById('scssSyntax').textContent)"
                        class="text-xs flex items-center text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-3.5 w-3.5 mr-1"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"
                          />
                        </svg>
                        Copy
                      </button>
                    </div>
                    <div
                      class="mt-3 bg-white dark:bg-gray-900 p-3 rounded font-mono text-xs overflow-x-auto border border-gray-100 dark:border-gray-800"
                    >
                      <code id="scssSyntax">$color: #CCCCCC;</code>
                    </div>
                  </div>

                  <!-- Tailwind CSS -->
                  <div
                    class="bg-gray-50 dark:bg-gray-800/50 p-3 rounded-lg transition-shadow hover:shadow-md"
                  >
                    <div class="flex justify-between items-center">
                      <div class="flex items-center">
                        <div
                          class="w-3 h-3 rounded-full bg-red-500 mr-1.5"
                        ></div>
                        <div
                          class="w-3 h-3 rounded-full bg-yellow-500 mr-1.5"
                        ></div>
                        <div
                          class="w-3 h-3 rounded-full bg-green-500 mr-2"
                        ></div>
                        <h3
                          class="text-sm font-medium text-gray-700 dark:text-gray-300"
                        >
                          Tailwind CSS
                        </h3>
                      </div>
                      <button
                        onclick="copyToClipboard(document.getElementById('tailwindSyntax').textContent)"
                        class="text-xs flex items-center text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400 transition-colors"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          class="h-3.5 w-3.5 mr-1"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"
                          />
                        </svg>
                        Copy
                      </button>
                    </div>
                    <div
                      class="mt-3 bg-white dark:bg-gray-900 p-3 rounded font-mono text-xs overflow-x-auto border border-gray-100 dark:border-gray-800"
                    >
                      <code id="tailwindSyntax"
                        >colors: { custom: '#CCCCCC' }</code
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Keyboard Shortcuts Section -->
            <div
              id="keyboard-shortcuts"
              class="mt-6 bg-white dark:bg-gray-800 rounded-lg overflow-hidden mb-6 shadow-md transition-all hover:shadow-lg"
            >
              <div
                class="p-3 border-b border-gray-200 dark:border-gray-700 flex items-center"
              >
                <div class="h-4 w-1 bg-blue-500 rounded mr-2"></div>
                <h2
                  class="text-base font-medium text-gray-900 dark:text-white flex items-center"
                >
                  <svg
                    class="w-4 h-4 mr-2 text-gray-600 dark:text-gray-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
                    ></path>
                  </svg>
                  <span class="gradient-text">Keyboard Shortcuts</span>
                </h2>
              </div>
              <div class="p-4 text-sm text-gray-700 dark:text-gray-300">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div class="space-y-4">
                    <div class="flex items-start">
                      <div class="flex-shrink-0 mt-1">
                        <div
                          class="h-7 w-12 bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-700 dark:text-gray-300 rounded border border-gray-300 dark:border-gray-600 font-mono text-xs"
                        >
                          Ctrl+C
                        </div>
                      </div>
                      <div class="ml-3">
                        <h3
                          class="text-sm font-medium text-gray-800 dark:text-gray-200"
                        >
                          Copy Selected Color
                        </h3>
                        <p
                          class="mt-1 text-xs text-gray-600 dark:text-gray-400"
                        >
                          Copy the currently selected color's hex value to your
                          clipboard (also works with Cmd+C on Mac).
                        </p>
                      </div>
                    </div>

                    <div class="flex items-start">
                      <div class="flex-shrink-0 mt-1">
                        <div
                          class="h-7 w-12 bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-700 dark:text-gray-300 rounded border border-gray-300 dark:border-gray-600 font-mono text-xs"
                        >
                          Space
                        </div>
                      </div>
                      <div class="ml-3">
                        <h3
                          class="text-sm font-medium text-gray-800 dark:text-gray-200"
                        >
                          Quick Copy
                        </h3>
                        <p
                          class="mt-1 text-xs text-gray-600 dark:text-gray-400"
                        >
                          Alternative shortcut to copy the selected color's hex
                          value to your clipboard.
                        </p>
                      </div>
                    </div>
                  </div>

                  <div class="space-y-4">
                    <div class="flex items-start">
                      <div class="flex-shrink-0 mt-1">
                        <div
                          class="h-7 w-7 bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-700 dark:text-gray-300 rounded border border-gray-300 dark:border-gray-600 font-mono text-xs"
                        >
                          U
                        </div>
                      </div>
                      <div class="ml-3">
                        <h3
                          class="text-sm font-medium text-gray-800 dark:text-gray-200"
                        >
                          Upload Image
                        </h3>
                        <p
                          class="mt-1 text-xs text-gray-600 dark:text-gray-400"
                        >
                          Open the file browser to upload a new image for color
                          extraction.
                        </p>
                      </div>
                    </div>

                    <div class="flex items-start">
                      <div class="flex-shrink-0 mt-1 flex items-center gap-1">
                        <div
                          class="h-7 w-7 bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-700 dark:text-gray-300 rounded border border-gray-300 dark:border-gray-600 font-mono text-xs"
                        >
                          1-5
                        </div>
                      </div>
                      <div class="ml-3">
                        <h3
                          class="text-sm font-medium text-gray-800 dark:text-gray-200"
                        >
                          Quick Color Selection
                        </h3>
                        <p
                          class="mt-1 text-xs text-gray-600 dark:text-gray-400"
                        >
                          Quickly select from the first five colors in the
                          extracted color palette.
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Info section about WCAG guidelines -->
            <div
              id="how-it-works"
              class="mt-6 bg-white dark:bg-gray-800 rounded-lg overflow-hidden mb-6 shadow-md transition-all hover:shadow-lg"
            >
              <div
                class="p-3 border-b border-gray-200 dark:border-gray-700 flex items-center"
              >
                <div class="h-4 w-1 bg-blue-500 rounded mr-2"></div>
                <h2
                  class="text-base font-medium text-gray-900 dark:text-white flex items-center"
                >
                  <svg
                    class="w-4 h-4 mr-2 text-gray-600 dark:text-gray-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    ></path>
                  </svg>
                  <span class="gradient-text">How does it work?</span>
                </h2>
              </div>
              <div class="p-4 text-sm text-gray-700 dark:text-gray-300">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div class="space-y-4">
                    <div class="flex items-start">
                      <div class="flex-shrink-0 mt-1">
                        <div
                          class="h-6 w-6 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400"
                        >
                          <span class="text-sm font-bold">1</span>
                        </div>
                      </div>
                      <div class="ml-3">
                        <h3
                          class="text-sm font-medium text-gray-800 dark:text-gray-200"
                        >
                          Upload an Image
                        </h3>
                        <p
                          class="mt-1 text-xs text-gray-600 dark:text-gray-400"
                        >
                          Upload any image by dragging and dropping or using the
                          file browser. You can also paste a URL to an online
                          image.
                        </p>
                      </div>
                    </div>

                    <div class="flex items-start">
                      <div class="flex-shrink-0 mt-1">
                        <div
                          class="h-6 w-6 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400"
                        >
                          <span class="text-sm font-bold">2</span>
                        </div>
                      </div>
                      <div class="ml-3">
                        <h3
                          class="text-sm font-medium text-gray-800 dark:text-gray-200"
                        >
                          Extract Colors
                        </h3>
                        <p
                          class="mt-1 text-xs text-gray-600 dark:text-gray-400"
                        >
                          Our algorithm automatically extracts the dominant
                          colors from your image, or you can click anywhere on
                          the image to pick specific colors.
                        </p>
                      </div>
                    </div>

                    <div class="flex items-start">
                      <div class="flex-shrink-0 mt-1">
                        <div
                          class="h-6 w-6 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400"
                        >
                          <span class="text-sm font-bold">3</span>
                        </div>
                      </div>
                      <div class="ml-3">
                        <h3
                          class="text-sm font-medium text-gray-800 dark:text-gray-200"
                        >
                          Explore Color Details
                        </h3>
                        <p
                          class="mt-1 text-xs text-gray-600 dark:text-gray-400"
                        >
                          View detailed information about each color including
                          RGB, HSL, and other color models. Simply click on any
                          color to select it.
                        </p>
                      </div>
                    </div>
                  </div>

                  <div class="space-y-4">
                    <div class="flex items-start">
                      <div class="flex-shrink-0 mt-1">
                        <div
                          class="h-6 w-6 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400"
                        >
                          <span class="text-sm font-bold">4</span>
                        </div>
                      </div>
                      <div class="ml-3">
                        <h3
                          class="text-sm font-medium text-gray-800 dark:text-gray-200"
                        >
                          Generate Color Harmonies
                        </h3>
                        <p
                          class="mt-1 text-xs text-gray-600 dark:text-gray-400"
                        >
                          Get complementary, monochromatic, analogous, triadic,
                          and tetradic color combinations based on your selected
                          color.
                        </p>
                      </div>
                    </div>

                    <div class="flex items-start">
                      <div class="flex-shrink-0 mt-1">
                        <div
                          class="h-6 w-6 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400"
                        >
                          <span class="text-sm font-bold">5</span>
                        </div>
                      </div>
                      <div class="ml-3">
                        <h3
                          class="text-sm font-medium text-gray-800 dark:text-gray-200"
                        >
                          Check Color Contrast
                        </h3>
                        <p
                          class="mt-1 text-xs text-gray-600 dark:text-gray-400"
                        >
                          Test accessibility by checking the contrast between
                          your selected colors and ensure they meet WCAG
                          standards for readability.
                        </p>
                      </div>
                    </div>

                    <div class="flex items-start">
                      <div class="flex-shrink-0 mt-1">
                        <div
                          class="h-6 w-6 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400"
                        >
                          <span class="text-sm font-bold">6</span>
                        </div>
                      </div>
                      <div class="ml-3">
                        <h3
                          class="text-sm font-medium text-gray-800 dark:text-gray-200"
                        >
                          Copy Code Snippets
                        </h3>
                        <p
                          class="mt-1 text-xs text-gray-600 dark:text-gray-400"
                        >
                          Use the ready-to-use code snippets in multiple
                          programming languages to integrate your colors into
                          your projects.
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Feature Details Section -->
            <div
              id="feature-details"
              class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden mb-6 shadow-md transition-all hover:shadow-lg"
            >
              <div
                class="p-3 border-b border-gray-200 dark:border-gray-700 flex items-center"
              >
                <div class="h-4 w-1 bg-blue-500 rounded mr-2"></div>
                <h2
                  class="text-base font-medium text-gray-900 dark:text-white flex items-center"
                >
                  <svg
                    class="w-4 h-4 mr-2 text-gray-600 dark:text-gray-400"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"
                    ></path>
                  </svg>
                  <span class="gradient-text">Image Color Extraction Tools</span>
                </h2>
              </div>

              <div class="p-4">
                <div class="space-y-8">
                  <!-- Extracted Colors -->
                  <div id="feature-extracted-colors" class="scroll-mt-24">
                    <div class="flex items-center mb-3">
                      <div
                        class="w-8 h-8 bg-blue-50 dark:bg-blue-900/30 rounded-lg flex items-center justify-center mr-3"
                      >
                        <svg
                          class="w-5 h-5 text-blue-600 dark:text-blue-400"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"
                          ></path>
                        </svg>
                      </div>
                      <h3
                        class="text-md font-medium text-gray-800 dark:text-gray-200"
                      >
                        Extracted Colors
                      </h3>
                    </div>
                    <div class="pl-11 pr-4">
                      <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                        Our advanced color extraction algorithm analyzes your
                        uploaded images to identify and extract the dominant
                        colors. This feature uses K-means clustering to process
                        the image data and determine the most prominent color
                        palette present in your visuals.
                      </p>
                      <div class="mt-3 flex flex-wrap gap-2">
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >color palette generator</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >extract colors from image</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >dominant color extraction</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >image color analysis</span
                        >
                      </div>
                    </div>
                  </div>

                  <!-- Color Details -->
                  <div id="feature-color-details" class="scroll-mt-24">
                    <div class="flex items-center mb-3">
                      <div
                        class="w-8 h-8 bg-blue-50 dark:bg-blue-900/30 rounded-lg flex items-center justify-center mr-3"
                      >
                        <svg
                          class="w-5 h-5 text-blue-600 dark:text-blue-400"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"
                          ></path>
                        </svg>
                      </div>
                      <h3
                        class="text-md font-medium text-gray-800 dark:text-gray-200"
                      >
                        Color Details
                      </h3>
                    </div>
                    <div class="pl-11 pr-4">
                      <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                        Get comprehensive information about any color including
                        hex codes, RGB, HSL, CMYK, and HSV values. This detailed
                        color analysis provides designers and developers with
                        all the technical specifications needed for precise
                        color implementation in various projects.
                      </p>
                      <div class="mt-3 flex flex-wrap gap-2">
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >hex color codes</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >RGB color values</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >HSL converter</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >color model converter</span
                        >
                      </div>
                    </div>
                  </div>

                  <!-- Color Variations -->
                  <div id="feature-color-variations" class="scroll-mt-24">
                    <div class="flex items-center mb-3">
                      <div
                        class="w-8 h-8 bg-blue-50 dark:bg-blue-900/30 rounded-lg flex items-center justify-center mr-3"
                      >
                        <svg
                          class="w-5 h-5 text-blue-600 dark:text-blue-400"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                          ></path>
                        </svg>
                      </div>
                      <h3
                        class="text-md font-medium text-gray-800 dark:text-gray-200"
                      >
                        Color Variations
                      </h3>
                    </div>
                    <div class="pl-11 pr-4">
                      <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                        Explore a spectrum of shades and tints derived from your
                        selected colors. This feature automatically generates
                        lighter and darker variations, creating a complete shade
                        range for designing gradients, UI elements, and
                        maintaining visual consistency in your projects.
                      </p>
                      <div class="mt-3 flex flex-wrap gap-2">
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >color shades generator</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >tints and shades</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >gradient color palette</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >lightness variations</span
                        >
                      </div>
                    </div>
                  </div>

                  <!-- Palette & Collage -->
                  <div id="feature-palette-collage" class="scroll-mt-24">
                    <div class="flex items-center mb-3">
                      <div
                        class="w-8 h-8 bg-blue-50 dark:bg-blue-900/30 rounded-lg flex items-center justify-center mr-3"
                      >
                        <svg
                          class="w-5 h-5 text-blue-600 dark:text-blue-400"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
                          ></path>
                        </svg>
                      </div>
                      <h3
                        class="text-md font-medium text-gray-800 dark:text-gray-200"
                      >
                        Palette & Collage
                      </h3>
                    </div>
                    <div class="pl-11 pr-4">
                      <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                        Visualize how your extracted colors work together in a
                        harmonious palette. The collage feature displays your
                        image alongside its color palette, creating a visual
                        reference that showcases the relationship between your
                        image and its color scheme.
                      </p>
                      <div class="mt-3 flex flex-wrap gap-2">
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >color scheme generator</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >image color palette</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >visual color collage</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >color palette visualization</span
                        >
                      </div>
                    </div>
                  </div>

                  <!-- Contrast Checker -->
                  <div id="feature-contrast-checker" class="scroll-mt-24">
                    <div class="flex items-center mb-3">
                      <div
                        class="w-8 h-8 bg-blue-50 dark:bg-blue-900/30 rounded-lg flex items-center justify-center mr-3"
                      >
                        <svg
                          class="w-5 h-5 text-blue-600 dark:text-blue-400"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"
                          ></path>
                        </svg>
                      </div>
                      <h3
                        class="text-md font-medium text-gray-800 dark:text-gray-200"
                      >
                        Contrast Checker
                      </h3>
                    </div>
                    <div class="pl-11 pr-4">
                      <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                        Ensure your color combinations meet accessibility
                        standards with our contrast checker. This tool
                        calculates the contrast ratio between text and
                        background colors according to WCAG guidelines, helping
                        you create designs that are readable for all users,
                        including those with visual impairments.
                      </p>
                      <div class="mt-3 flex flex-wrap gap-2">
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >accessibility checker</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >WCAG color contrast</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >text readability tool</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >ADA compliant colors</span
                        >
                      </div>
                    </div>
                  </div>

                  <!-- Color Harmony -->
                  <div id="feature-color-harmony" class="scroll-mt-24">
                    <div class="flex items-center mb-3">
                      <div
                        class="w-8 h-8 bg-blue-50 dark:bg-blue-900/30 rounded-lg flex items-center justify-center mr-3"
                      >
                        <svg
                          class="w-5 h-5 text-blue-600 dark:text-blue-400"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
                          ></path>
                        </svg>
                      </div>
                      <h3
                        class="text-md font-medium text-gray-800 dark:text-gray-200"
                      >
                        <span class="gradient-text">Color Harmony</span>
                      </h3>
                    </div>
                    <div class="pl-11 pr-4">
                      <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                        Discover perfectly matched color combinations using
                        color theory principles. Our tool generates
                        complementary, monochromatic, analogous, triadic, and
                        tetradic color harmonies based on your selected colors,
                        providing you with professional color schemes for your
                        design projects.
                      </p>
                      <div class="mt-3 flex flex-wrap gap-2">
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >color wheel combinations</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >complementary colors</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >color theory generator</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >harmonious color schemes</span
                        >
                      </div>
                    </div>
                  </div>

                  <!-- Code Snippets -->
                  <div id="feature-code-snippets" class="scroll-mt-24">
                    <div class="flex items-center mb-3">
                      <div
                        class="w-8 h-8 bg-blue-50 dark:bg-blue-900/30 rounded-lg flex items-center justify-center mr-3"
                      >
                        <svg
                          class="w-5 h-5 text-blue-600 dark:text-blue-400"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"
                          ></path>
                        </svg>
                      </div>
                      <h3
                        class="text-md font-medium text-gray-800 dark:text-gray-200"
                      >
                        Code Snippets
                      </h3>
                    </div>
                    <div class="pl-11 pr-4">
                      <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                        Seamlessly integrate your selected colors into your
                        development workflow with ready-to-use code snippets. We
                        provide syntax for CSS, HTML, JavaScript, Android/Java,
                        Swift, Flutter/Dart, SCSS, and Tailwind CSS, allowing
                        you to directly copy and paste color values into your
                        projects.
                      </p>
                      <div class="mt-3 flex flex-wrap gap-2">
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >CSS color codes</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >developer color tools</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >programming color syntax</span
                        >
                        <span
                          class="inline-block px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-xs text-gray-700 dark:text-gray-300"
                          >color implementation code</span
                        >
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Color Variations Section -->
            <div
              id="colorVariations"
              class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4"
            >
              <!-- Color variations will be added here -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script>
      // Global function to set up image for color picking - defined at the very top to ensure it's available everywhere
      window.setupImageForColorPicking = function () {
        const mainImageDisplay = document.getElementById("mainImageDisplay");
        const canvas = window._colorPickerCanvas;
        const ctx = window._colorPickerCtx;

        if (!mainImageDisplay || !canvas || !ctx) {
          console.error("setupImageForColorPicking: missing elements");
          return;
        }

        // Wait for image to be fully loaded
        if (!mainImageDisplay.complete || mainImageDisplay.naturalWidth === 0) {
          console.warn("setupImageForColorPicking: image not fully loaded yet");
          return;
        }

        canvas.width = mainImageDisplay.naturalWidth;
        canvas.height = mainImageDisplay.naturalHeight;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(mainImageDisplay, 0, 0, canvas.width, canvas.height);
        window.imageLoaded = true;
        console.log(
          "setupImageForColorPicking: canvas updated with image src:",
          mainImageDisplay.src.substring(0, 80)
        );
      };

      // Global helper function for color conversion
      window.rgbToHex = function (r, g, b) {
        return `#${((1 << 24) | (r << 16) | (g << 8) | b)
          .toString(16)
          .slice(1)}`;
      };

      // Implement updateNavbarColor to actually update the navbar color and CSS variables
      window.updateNavbarColor = function (hexColor) {
        console.log("updateNavbarColor called with", hexColor);

        // Convert hex to RGB
        function hexToRgb(hex) {
          hex = hex.replace("#", "");
          if (hex.length === 3) {
            hex = hex
              .split("")
              .map((x) => x + x)
              .join("");
          }
          const num = parseInt(hex, 16);
          return [(num >> 16) & 255, (num >> 8) & 255, num & 255];
        }

        const rgb = hexToRgb(hexColor);

        // Set CSS variables for scroll event usage
        document.documentElement.style.setProperty(
          "--selected-color-r",
          rgb[0]
        );
        document.documentElement.style.setProperty(
          "--selected-color-g",
          rgb[1]
        );
        document.documentElement.style.setProperty(
          "--selected-color-b",
          rgb[2]
        );

        // Calculate perceived brightness
        const brightness = (rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000;

        // Set text color based on brightness
        const textColor = brightness < 128 ? "#ffffff" : "#000000";

        // Update all dynamic-contrast elements
        const contrastElements = document.querySelectorAll(".dynamic-contrast");
        contrastElements.forEach((element) => {
          element.style.color = textColor;
        });

        // Set navbar background with glass effect
        const navbar = document.querySelector(".navbar");
        if (navbar) {
          const isScrolled = navbar.classList.contains("scrolled");
          if (isScrolled) {
            // More transparent background when scrolled with glass effect
            navbar.style.background = `rgba(${rgb[0]}, ${rgb[1]}, ${rgb[2]}, 0.02)`; // Reduced from 0.05 to 0.02
            navbar.style.backdropFilter = "blur(6px)"; // Reduced from 8px to 6px for even lighter effect
            navbar.style.webkitBackdropFilter = "blur(6px)";
            navbar.style.borderBottom = `1px solid ${
              textColor === "#ffffff"
                ? "rgba(255, 255, 255, 0.02)"
                : "rgba(0, 0, 0, 0.02)"
            }`;
          } else {
            // Original styling when at top
            navbar.style.background = `rgba(${rgb[0]}, ${rgb[1]}, ${rgb[2]}, 0.6)`;
            navbar.style.backdropFilter = "blur(50px)";
            navbar.style.webkitBackdropFilter = "blur(50px)";
          }
        }
      };

      // Define backend URL
      const BACKEND_URL = "https://api.color-peek.com";

      // Test backend connectivity
      async function testBackendConnectivity() {
        try {
          console.log("Testing backend connectivity...");
          // Always keep the error banner hidden regardless of backend status
          document.getElementById("backendErrorBanner").classList.add("hidden");

          const response = await fetch(`${BACKEND_URL}/health`, {
            method: "GET",
            mode: "cors",
          });

          if (response.ok) {
            console.log("Backend server is responding properly");
          } else {
            console.error(
              "Backend server responded with status:",
              response.status
            );
            // Don't show error banner
          }
        } catch (error) {
          console.error("Error connecting to backend:", error);
          // Don't show error banner
        }
      }

      // Theme toggle functionality
      document.addEventListener("DOMContentLoaded", function () {
        // Test backend connectivity
        testBackendConnectivity();

        const themeToggle = document.getElementById("themeToggle");
        const imageInput = document.getElementById("imageInput");
        const mainImageDisplay = document.getElementById("mainImageDisplay");

        // Add input event listener directly to ensure it works
        imageInput.addEventListener("change", function () {
          console.log("imageInput change event triggered");
          previewImage(this);
        });

        let imageLoaded = false;
        window._colorPickerCanvas = document.createElement("canvas");
        window._colorPickerCtx = window._colorPickerCanvas.getContext("2d", {
          willReadFrequently: true,
        });

        // Ensure the mainImageDisplay is working properly
        if (mainImageDisplay) {
          console.log("mainImageDisplay found on page load");
          mainImageDisplay.onload = function () {
            console.log(
              "Image loaded successfully:",
              mainImageDisplay.src.substring(0, 50) + "..."
            );
          };
          mainImageDisplay.onerror = function () {
            console.error("Error loading image!");
          };
        } else {
          console.error("mainImageDisplay not found on page load!");
        }

        // Set initial toggle state based on current theme
        themeToggle.checked =
          document.documentElement.classList.contains("dark-mode");

        // Add toggle event listener
        themeToggle.addEventListener("change", function () {
          if (this.checked) {
            document.documentElement.classList.add("dark-mode");
            document.documentElement.classList.add("dark");
            localStorage.setItem("theme", "dark");
          } else {
            document.documentElement.classList.remove("dark-mode");
            document.documentElement.classList.remove("dark");
            localStorage.setItem("theme", "light");
          }
        });

        // Initialize scroll behavior for navbar
        window.addEventListener("scroll", function () {
          const navbar = document.querySelector(".navbar");
          const navbarContainer = document.querySelector(".navbar-container");

          if (window.scrollY > 0) {
            navbar.classList.add("scrolled");
            navbarContainer.classList.add("scrolled");
            navbarContainer.style.width = "100%";

            // Update navbar color with higher opacity when scrolled
            if (
              document.documentElement.style.getPropertyValue(
                "--selected-color-r"
              )
            ) {
              const r =
                document.documentElement.style.getPropertyValue(
                  "--selected-color-r"
                );
              const g =
                document.documentElement.style.getPropertyValue(
                  "--selected-color-g"
                );
              const b =
                document.documentElement.style.getPropertyValue(
                  "--selected-color-b"
                );
              navbar.style.background = `rgba(${r}, ${g}, ${b}, 0.9)`;
            }
          } else {
            navbar.classList.remove("scrolled");
            navbarContainer.classList.remove("scrolled");
            navbarContainer.style.width = "100%";

            // Update navbar color with lower opacity when at top
            if (
              document.documentElement.style.getPropertyValue(
                "--selected-color-r"
              )
            ) {
              const r =
                document.documentElement.style.getPropertyValue(
                  "--selected-color-r"
                );
              const g =
                document.documentElement.style.getPropertyValue(
                  "--selected-color-g"
                );
              const b =
                document.documentElement.style.getPropertyValue(
                  "--selected-color-b"
                );
              navbar.style.background = `rgba(${r}, ${g}, ${b}, 0.6)`;
            }
          }

          // Image scroll behavior
          handleImageScroll();
        });

        // Handle image scroll behavior
        function handleImageScroll() {
          // Keep all elements in their original positions regardless of scroll
          // No moving images from main content to sidebar
          const mainImageContainer =
            document.getElementById("mainImageContainer");
          const scrolledImageContainer = document.getElementById(
            "scrolledImageContainer"
          );

          // Always keep the main image visible and sidebar image hidden
          mainImageContainer.classList.remove("hidden");
          if (scrolledImageContainer) {
            scrolledImageContainer.classList.add("hidden");
          }
        }

        // Initialize drag and drop for the upload zone
        initDragAndDrop();

        // Extract colors from the default image when the page loads
        extractColorsFromDefaultImage();

        // --- Refactor image loading to always update color picking canvas correctly ---
        // Set up mainImageDisplay onload handler ONCE on DOMContentLoaded
        if (mainImageDisplay) {
          mainImageDisplay.addEventListener("load", function () {
            setupImageForColorPicking();
          });
        }
      });

      // Switch between device and URL upload tabs
      function switchTab(tab) {
        // Get tab elements
        const deviceTab = document.getElementById("deviceUploadTab");
        const urlTab = document.getElementById("urlUploadTab");
        const deviceSection = document.getElementById("deviceUploadSection");
        const urlSection = document.getElementById("urlUploadSection");

        if (tab === "device") {
          // Activate device tab
          deviceTab.classList.add(
            "text-blue-600",
            "dark:text-blue-400",
            "border-b-2",
            "border-blue-600",
            "dark:border-blue-400"
          );
          deviceTab.classList.remove("text-gray-500", "dark:text-gray-400");
          deviceSection.classList.remove("hidden");

          // Deactivate URL tab
          urlTab.classList.remove(
            "text-blue-600",
            "dark:text-blue-400",
            "border-b-2",
            "border-blue-600",
            "dark:border-blue-400"
          );
          urlTab.classList.add("text-gray-500", "dark:text-gray-400");
          urlSection.classList.add("hidden");
        } else {
          // Activate URL tab
          urlTab.classList.add(
            "text-blue-600",
            "dark:text-blue-400",
            "border-b-2",
            "border-blue-600",
            "dark:border-blue-400"
          );
          urlTab.classList.remove("text-gray-500", "dark:text-gray-400");
          urlSection.classList.remove("hidden");

          // Deactivate device tab
          deviceTab.classList.remove(
            "text-blue-600",
            "dark:text-blue-400",
            "border-b-2",
            "border-blue-600",
            "dark:border-blue-400"
          );
          deviceTab.classList.add("text-gray-500", "dark:text-gray-400");
          deviceSection.classList.add("hidden");
        }
      }

      // Initialize drag and drop functionality
      function initDragAndDrop() {
        const dropZone = document.getElementById("dropZone");
        const imageInput = document.getElementById("imageInput");

        // Prevent default drag behaviors
        ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
          dropZone.addEventListener(eventName, preventDefaults, false);
        });

        // Highlight drop zone when dragging over it
        ["dragenter", "dragover"].forEach((eventName) => {
          dropZone.addEventListener(eventName, highlight, false);
        });

        ["dragleave", "drop"].forEach((eventName) => {
          dropZone.addEventListener(eventName, unhighlight, false);
        });

        // Handle dropped files
        dropZone.addEventListener("drop", handleDrop, false);

        function preventDefaults(e) {
          e.preventDefault();
          e.stopPropagation();
        }

        function highlight() {
          dropZone.classList.add(
            "border-blue-500",
            "dark:border-blue-400",
            "bg-blue-50",
            "dark:bg-blue-900/10"
          );
        }

        function unhighlight() {
          dropZone.classList.remove(
            "border-blue-500",
            "dark:border-blue-400",
            "bg-blue-50",
            "dark:bg-blue-900/10"
          );
        }

        function handleDrop(e) {
          const dt = e.dataTransfer;
          const files = dt.files;

          if (files.length) {
            imageInput.files = files;
            previewImage(imageInput);
          }
        }
      }

      // Function to reliably update the main image
      function updateMainImage(imageDataUrl) {
        const mainImageDisplay = document.getElementById("mainImageDisplay");
        if (!mainImageDisplay) {
          console.error("mainImageDisplay element not found!");
          return false;
        }
        try {
          // Set up onload handler before setting src
          mainImageDisplay.onload = function () {
            setupImageForColorPicking();
          };
          mainImageDisplay.src = imageDataUrl;
          // If already loaded (from cache), call directly
          if (
            mainImageDisplay.complete &&
            mainImageDisplay.naturalWidth !== 0
          ) {
            setupImageForColorPicking();
          }
          return true;
        } catch (error) {
          console.error("Error updating image:", error);
          return false;
        }
      }

      // Preview uploaded image
      function previewImage(input) {
        if (input.files && input.files[0]) {
          console.log("Reading uploaded file");
          const file = input.files[0];
          const reader = new FileReader();
          reader.onload = function (e) {
            const mainImageDisplay =
              document.getElementById("mainImageDisplay");
            // Set up onload handler before src
            mainImageDisplay.onload = function () {
              setupImageForColorPicking();
            };
            mainImageDisplay.src = e.target.result;
            mainImageDisplay.style.display = "block";
            setTimeout(() => {
              extractColors();
            }, 100);
            // If already loaded (from cache), call directly
            if (
              mainImageDisplay.complete &&
              mainImageDisplay.naturalWidth !== 0
            ) {
              setupImageForColorPicking();
            }
          };
          reader.readAsDataURL(file);
        }
      }

      // Fetch and process image from URL
      async function fetchImageFromUrl() {
        try {
          const urlInput = document.getElementById("imageUrl");
          const imageUrl = urlInput.value.trim();
          if (!imageUrl) {
            showError("Please enter an image URL");
            return;
          }
          setUrlLoading(true);
          hideError();
          const response = await fetch(imageUrl);
          if (!response.ok) {
            throw new Error("Failed to fetch image from URL");
          }
          const contentType = response.headers.get("content-type");
          if (
            !contentType ||
            (!contentType.includes("image/jpeg") &&
              !contentType.includes("image/png"))
          ) {
            throw new Error("URL must point to a JPEG or PNG image");
          }
          const blob = await response.blob();
          const file = new File([blob], "image-from-url.jpg", {
            type: contentType,
          });
          const reader = new FileReader();
          reader.onload = function (e) {
            const mainImageDisplay =
              document.getElementById("mainImageDisplay");
            // Set up onload handler before src
            mainImageDisplay.onload = function () {
              setupImageForColorPicking();
              // Extract colors from the URL-fetched image
              extractColorsFromUrl(file);
            };
            mainImageDisplay.src = e.target.result;
            mainImageDisplay.style.display = "block";

            // If already loaded (from cache), call directly
            if (
              mainImageDisplay.complete &&
              mainImageDisplay.naturalWidth !== 0
            ) {
              setupImageForColorPicking();
              extractColorsFromUrl(file);
            }
          };
          reader.readAsDataURL(file);
        } catch (error) {
          showError("Failed to process image: " + error.message);
        } finally {
          setUrlLoading(false);
        }
      }

      // Extract colors from URL-fetched image
      async function extractColorsFromUrl(file) {
        try {
          console.log("extractColorsFromUrl function called");

          if (!file) {
            showError("Failed to process URL image");
            console.log("No file available from URL");
            return;
          }

          console.log("Processing URL file:", file.name);

          // Check file size (10MB limit)
          const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB in bytes
          if (file.size > MAX_FILE_SIZE) {
            showError("Image is too large. Maximum size is 10MB.");
            return;
          }

          // Validate file type
          const validTypes = ["image/jpeg", "image/png", "image/jpg"];
          if (!validTypes.includes(file.type)) {
            showError("Please select a valid image file (JPEG or PNG)");
            return;
          }

          setUrlLoading(true);
          hideError();

          const formData = new FormData();
          formData.append("image", file);

          console.log("Sending URL image to backend");
          const response = await fetch(`${BACKEND_URL}/extract-colors`, {
            method: "POST",
            mode: "cors",
            body: formData,
          });

          if (!response.ok) {
            if (response.status === 0)
              throw new Error("Cannot connect to backend");

            // Try to get more detailed error from the response
            try {
              const errorData = await response.json();
              if (errorData && errorData.error) {
                throw new Error(errorData.error);
              }
            } catch (jsonError) {
              // If parsing JSON fails, use the status text
            }

            throw new Error(
              `Server responded with ${response.status}: ${response.statusText}`
            );
          }

          console.log("Received response from backend for URL image");
          const colors = await response.json();
          console.log("Extracted colors from URL image:", colors);
          displayColors(colors);
        } catch (error) {
          console.error("Error extracting colors from URL:", error);
          if (
            error.message.includes("Failed to fetch") ||
            error.message.includes("Cannot connect")
          ) {
            showError(
              "Cannot connect to backend server. Please try again later."
            );
          } else {
            showError("Failed to extract colors: " + error.message);
          }
        } finally {
          setUrlLoading(false);
        }
      }

      // Show error message
      function showError(message) {
        const errorElement = document.getElementById("errorMessage");
        errorElement.textContent = message;
        errorElement.classList.remove("hidden");
      }

      // Hide error message
      function hideError() {
        const errorElement = document.getElementById("errorMessage");
        errorElement.classList.add("hidden");
      }

      // Set loading state
      function setLoading(isLoading) {
        const button = document.getElementById("extractButton");
        const loaderContainer = document.getElementById("loaderContainer");
        const buttonText = document.getElementById("buttonText");

        button.disabled = isLoading;

        if (isLoading) {
          loaderContainer.classList.remove("hidden");
          buttonText.textContent = "Processing...";
        } else {
          loaderContainer.classList.add("hidden");
          buttonText.textContent = "Upload Image";
        }
      }

      // Set loading state for URL fetch
      function setUrlLoading(isLoading) {
        const button = document.getElementById("fetchUrlButton");
        const loaderContainer = document.getElementById("urlLoaderContainer");
        const buttonText = document.getElementById("urlButtonText");

        button.disabled = isLoading;

        if (isLoading) {
          loaderContainer.classList.remove("hidden");
          buttonText.textContent = "Fetching...";
        } else {
          loaderContainer.classList.add("hidden");
          buttonText.textContent = "Fetch Image";
        }
      }

      // Extract colors from uploaded image
      async function extractColors() {
        try {
          console.log("extractColors function called");
          const input = document.getElementById("imageInput");

          if (!input.files || !input.files[0]) {
            showError("Please select an image file");
            console.log("No file selected");
            return;
          }

          const file = input.files[0];
          console.log("Processing file:", file.name);

          // Check file size (10MB limit)
          const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB in bytes
          if (file.size > MAX_FILE_SIZE) {
            showError("Image is too large. Maximum size is 10MB.");
            return;
          }

          // Validate file type
          const validTypes = ["image/jpeg", "image/png", "image/jpg"];
          if (!validTypes.includes(file.type)) {
            showError("Please select a valid image file (JPEG or PNG)");
            return;
          }

          setLoading(true);
          hideError();

          const formData = new FormData();
          formData.append("image", file);

          console.log("Sending request to backend");
          const response = await fetch(`${BACKEND_URL}/extract-colors`, {
            method: "POST",
            mode: "cors",
            body: formData,
          });

          if (!response.ok) {
            if (response.status === 0)
              throw new Error("Cannot connect to backend");

            // Try to get more detailed error from the response
            try {
              const errorData = await response.json();
              if (errorData && errorData.error) {
                throw new Error(errorData.error);
              }
            } catch (jsonError) {
              // If parsing JSON fails, use the status text
            }

            throw new Error(
              `Server responded with ${response.status}: ${response.statusText}`
            );
          }

          console.log("Received response from backend");
          const colors = await response.json();
          console.log("Extracted colors:", colors);
          displayColors(colors);
        } catch (error) {
          console.error("Error extracting colors:", error);
          if (
            error.message.includes("Failed to fetch") ||
            error.message.includes("Cannot connect")
          ) {
            showError(
              "Cannot connect to backend server. Please try again later."
            );
          } else {
            showError("Failed to extract colors: " + error.message);
          }
        } finally {
          setLoading(false);
        }
      }

      // Display extracted colors
      function displayColors(colors) {
        const container = document.getElementById("extractedColorsContainer");
        console.log("Displaying colors in container:", container);

        // Clear existing colors
        container.innerHTML = "";

        // Add heading with modern style
        const heading = document.createElement("div");
        heading.className =
          "p-3 border-b border-gray-200 dark:border-gray-700 flex items-center";
        heading.innerHTML = `
          <div class="h-4 w-1 bg-blue-500 rounded mr-2"></div>
          <h2 class="text-base font-medium text-gray-900 dark:text-white flex items-center">
            <svg class="w-4 h-4 mr-2 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
            </svg>
            Extracted Colors
          </h2>
        `;
        container.appendChild(heading);

        // Sort colors by frequency
        const sortedColors = colors.sort((a, b) => b.frequency - a.frequency);

        // Take the first 5 colors
        const topColors = sortedColors.slice(0, 5);
        console.log("Top colors to display:", topColors);

        // Create the uiverse palette container
        const paletteContainer = document.createElement("div");
        paletteContainer.className = "palette-container";
        console.log(
          "Created modern palette container with expand-on-hover effect"
        );

        // Create the color palette
        const colorPalette = document.createElement("div");
        colorPalette.className = "color-palette";
        colorPalette.id = "colorPalette";

        // Create color items
        topColors.forEach((colorData) => {
          const colorItem = document.createElement("div");
          colorItem.className = "color-item";
          colorItem.style.backgroundColor = colorData.color;

          // Instead of using onclick property, use addEventListener for better control
          colorItem.addEventListener("click", function () {
            console.log("Color palette item clicked:", colorData.color);
            selectColor(colorData.color);
          });

          // Create color hex span
          const colorHex = document.createElement("span");
          colorHex.className = "color-hex";
          colorHex.textContent = colorData.color.toUpperCase().replace("#", "");

          // Create percentage span
          const colorPercent = document.createElement("span");
          colorPercent.className = "color-percent";
          const percentage = Math.round(
            (colorData.frequency / colors[0].frequency) * 100
          );
          colorPercent.textContent = `${percentage}%`;

          colorItem.appendChild(colorHex);
          colorItem.appendChild(colorPercent);
          colorPalette.appendChild(colorItem);
          console.log("Added color to modern palette:", colorData.color);
        });

        // Create stats bar
        const statsBar = document.createElement("div");
        statsBar.className = "palette-stats";

        // Add info text
        const statsText = document.createElement("span");
        statsText.textContent = "Click a color to select";

        // Add options menu
        const statsMenu = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "svg"
        );
        statsMenu.setAttribute("xmlns", "http://www.w3.org/2000/svg");
        statsMenu.setAttribute("width", "18");
        statsMenu.setAttribute("height", "18");
        statsMenu.setAttribute("viewBox", "0 0 18 18");
        statsMenu.innerHTML =
          '<path d="M4 7.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5S5.5 9.83 5.5 9 4.83 7.5 4 7.5zm10 0c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm-5 0c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5S9.83 7.5 9 7.5z"></path>';
        statsMenu.onclick = () => showToast("Color palette options");

        statsBar.appendChild(statsText);
        statsBar.appendChild(statsMenu);

        // Assemble the palette container
        paletteContainer.appendChild(colorPalette);
        paletteContainer.appendChild(statsBar);

        // Add palette to the container
        container.appendChild(paletteContainer);

        // Show the container
        container.classList.remove("hidden");
        console.log("Color palette created with ID:", colorPalette.id);

        // Set the navbar color based on the first color
        if (topColors.length > 0) {
          try {
            if (typeof updateNavbarColor === "function") {
              console.log(
                "Calling updateNavbarColor with color:",
                topColors[0].color
              );
              updateNavbarColor(topColors[0].color);
            } else {
              console.warn("updateNavbarColor function is not defined yet");
            }
          } catch (e) {
            console.error("Error calling updateNavbarColor:", e.message);
          }
        }

        // In the displayColors function, after displaying the main palette, also update the new palette/collage section:
        // (Add this JS snippet at the end of displayColors)
        (function updatePaletteCollageSection() {
          const section = document.getElementById("paletteCollageContainer");
          if (section) section.classList.remove("hidden");
          // Palette colors
          const palette = document.getElementById("uiversePalette");
          const collagePalette = document.getElementById("collagePalette");
          if (palette) palette.innerHTML = "";
          if (collagePalette) collagePalette.innerHTML = "";
          // Use top 5 colors
          const topColors = colors.slice(0, 5);
          topColors.forEach((colorData) => {
            const colorDiv = document.createElement("div");
            colorDiv.className = "uiverse-color";
            colorDiv.style.background = colorData.color;
            const span = document.createElement("span");
            span.textContent = colorData.color.replace("#", "").toUpperCase();
            colorDiv.appendChild(span);
            if (palette) palette.appendChild(colorDiv.cloneNode(true));
            if (collagePalette)
              collagePalette.appendChild(colorDiv.cloneNode(true));
          });
          // Update collage image
          const collageImg = document.getElementById("collageImage");
          const mainImg = document.getElementById("mainImageDisplay");
          if (collageImg && mainImg) collageImg.src = mainImg.src;
        })();
      }

      // Copy color to clipboard
      function copyToClipboard(text) {
        navigator.clipboard
          .writeText(text)
          .then(() => {
            // Show a toast notification
            showToast(`Copied ${text} to clipboard`);
          })
          .catch((err) => {
            console.error("Failed to copy: ", err);
          });
      }

      // Function to select a color - this is needed for the color palette functionality
      function selectColor(color, skipCopy = false) {
        console.log(`Selecting color: ${color}`);

        // Copy to clipboard only if skipCopy is false
        if (!skipCopy) {
          copyToClipboard(color);
        }

        // Update navbar color
        try {
          if (typeof updateNavbarColor === "function") {
            updateNavbarColor(color);
          } else {
            console.warn("updateNavbarColor function is not defined yet");
          }
        } catch (e) {
          console.error("Error calling updateNavbarColor:", e.message);
        }

        // Add the selected color to the palette
        addClickedColorToPalette(color);

        // Highlight the selected color in the palette
        const colorItems = document.querySelectorAll(".color-item");
        colorItems.forEach((item) => {
          const hexElement = item.querySelector(".color-hex");
          const colorBg = item.style.backgroundColor;

          // Convert backgroundColor (rgb format) to hex for comparison if needed
          let itemHexColor = "";
          if (colorBg.startsWith("rgb")) {
            // Parse RGB values
            const rgbValues = colorBg.match(/\d+/g).map(Number);
            if (rgbValues.length >= 3) {
              itemHexColor = rgbToHex(rgbValues[0], rgbValues[1], rgbValues[2]);
            }
          }

          // Check if this is our color (either by hex text or by background color)
          if (
            (hexElement &&
              "#" + hexElement.textContent.toUpperCase() ===
                color.toUpperCase()) ||
            (itemHexColor && itemHexColor.toUpperCase() === color.toUpperCase())
          ) {
            item.classList.add("highlight-pulse");
            setTimeout(() => {
              item.classList.remove("highlight-pulse");
            }, 1000);
          }
        });

        // Also add the color to the palette if it's not already there
        console.log("Adding selected color to the modern palette:", color);
        addClickedColorToPalette(color);
      }

      // Show toast notification
      function showToast(message) {
        // Create toast if it doesn't exist
        let toast = document.getElementById("toast");
        if (!toast) {
          toast = document.createElement("div");
          toast.id = "toast";
          toast.className =
            "fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg opacity-0 transition-opacity duration-300 z-50";
          document.body.appendChild(toast);
        }

        // Set message and show
        toast.textContent = message;
        toast.classList.remove("opacity-0");
        toast.classList.add("opacity-100");

        // Hide after 3 seconds
        setTimeout(() => {
          toast.classList.remove("opacity-100");
          toast.classList.add("opacity-0");
        }, 3000);
      }

      // Function to extract colors from the default image on page load
      async function extractColorsFromDefaultImage() {
        try {
          // Get the default image URL from the main image display
          const mainImageDisplay = document.getElementById("mainImageDisplay");
          const imageUrl = mainImageDisplay.src;

          // Fetch the image from the URL
          const response = await fetch(imageUrl);

          if (!response.ok) {
            throw new Error("Failed to fetch default image");
          }

          const blob = await response.blob();

          // Create a FormData object
          const formData = new FormData();
          formData.append("image", blob);

          // Send to backend to extract colors
          const colorResponse = await fetch(`${BACKEND_URL}/extract-colors`, {
            method: "POST",
            mode: "cors",
            body: formData,
          });

          if (!colorResponse.ok) {
            throw new Error(
              `Server responded with ${colorResponse.status}: ${colorResponse.statusText}`
            );
          }

          const colors = await colorResponse.json();
          displayColors(colors);
        } catch (error) {
          console.error("Error extracting colors from default image:", error);
        }
      }

      // New function to trigger file upload
      function triggerFileUpload() {
        document.getElementById("imageInput").click();
      }

      // Magnifier and color picking functionality
      document.addEventListener("DOMContentLoaded", function () {
        console.log("DOM loaded, setting up magnifier and color picker");

        const mainImageContainer =
          document.getElementById("mainImageContainer");
        const mainImageDisplay = document.getElementById("mainImageDisplay");
        const magnifier = document.getElementById("magnifier");
        const colorInfo = document.getElementById("colorInfo");

        if (
          !mainImageContainer ||
          !mainImageDisplay ||
          !magnifier ||
          !colorInfo
        ) {
          console.error(
            "Missing required elements for magnifier functionality"
          );
          return;
        }

        console.log("Found all required elements for magnifier");

        // Get the magnifier canvas
        const magnifierCanvas = document.getElementById("magnifierCanvas");
        if (!magnifierCanvas) {
          console.error("Magnifier canvas not found");
          return;
        }

        const magnifierCtx = magnifierCanvas.getContext("2d");
        console.log("Magnifier canvas initialized");

        // Handle image load to prepare for color picking
        function setupImageForColorPicking() {
          const mainImageDisplay = document.getElementById("mainImageDisplay");
          const canvas = window._colorPickerCanvas;
          const ctx = window._colorPickerCtx;
          if (!mainImageDisplay || !canvas || !ctx) {
            console.error("setupImageForColorPicking: missing elements");
            return;
          }
          // Wait for image to be fully loaded
          if (
            !mainImageDisplay.complete ||
            mainImageDisplay.naturalWidth === 0
          ) {
            console.warn(
              "setupImageForColorPicking: image not fully loaded yet"
            );
            return;
          }
          canvas.width = mainImageDisplay.naturalWidth;
          canvas.height = mainImageDisplay.naturalHeight;
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(mainImageDisplay, 0, 0, canvas.width, canvas.height);
          imageLoaded = true;
          // Automatically extract colors when image is loaded
          try {
            console.log("Auto-extracting colors after image load");
            extractColorsFromDefaultImage();
            // Make sure the extracted colors container is visible
            const extractedColorsContainer = document.getElementById(
              "extractedColorsContainer"
            );
            if (extractedColorsContainer) {
              extractedColorsContainer.classList.remove("hidden");
            }
          } catch (err) {
            console.error("Error automatically extracting colors:", err);
          }
          console.log(
            "setupImageForColorPicking: canvas updated with image src:",
            mainImageDisplay.src.substring(0, 80)
          );
        }

        // Set up the image onload handler
        if (mainImageDisplay.complete) {
          console.log("Image already loaded, setting up now");
          setupImageForColorPicking();
        } else {
          console.log("Setting up image onload handler");
          mainImageDisplay.onload = setupImageForColorPicking;
        }

        // Mouse move handler for magnifier
        mainImageContainer.addEventListener("mousemove", function (e) {
          if (!imageLoaded) {
            console.log("Image not loaded yet, skipping magnifier update");
            return;
          }

          console.log("Mouse move detected, updating magnifier");

          // Get mouse position relative to image container
          const rect = mainImageDisplay.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;

          // First, calculate the actual image dimensions within the container
          // Since the image is "object-contain", it might not fill the entire container
          const actualImageWidth = mainImageDisplay.naturalWidth;
          const actualImageHeight = mainImageDisplay.naturalHeight;

          console.log(
            `Image dimensions: ${actualImageWidth}x${actualImageHeight}`
          );
          console.log(`Mouse position: ${x}, ${y}`);

          // Calculate the displayed image dimensions (maintaining aspect ratio)
          let displayedImageWidth, displayedImageHeight;
          const containerRatio = rect.width / rect.height;
          const imageRatio = actualImageWidth / actualImageHeight;

          if (imageRatio > containerRatio) {
            // Image is wider than container (relative to their heights)
            displayedImageWidth = rect.width;
            displayedImageHeight = rect.width / imageRatio;
          } else {
            // Image is taller than container (relative to their widths)
            displayedImageHeight = rect.height;
            displayedImageWidth = rect.height * imageRatio;
          }

          // Calculate the position where the actual image starts (centered in container)
          const imageOffsetX = (rect.width - displayedImageWidth) / 2;
          const imageOffsetY = (rect.height - displayedImageHeight) / 2;

          // Check if mouse is over the actual image (not just the container)
          if (
            x < imageOffsetX ||
            x > imageOffsetX + displayedImageWidth ||
            y < imageOffsetY ||
            y > imageOffsetY + displayedImageHeight
          ) {
            console.log("Mouse outside image bounds, hiding magnifier");
            magnifier.classList.add("hidden");
            return;
          }

          // Convert container coordinates to image coordinates
          const imageX =
            ((x - imageOffsetX) / displayedImageWidth) * actualImageWidth;
          const imageY =
            ((y - imageOffsetY) / displayedImageHeight) * actualImageHeight;

          // Show magnifier
          console.log("Showing magnifier");
          magnifier.classList.remove("hidden");

          // Also show the live color preview
          const liveColorPreview = document.getElementById("liveColorPreview");
          liveColorPreview.classList.remove("hidden");
          liveColorPreview.style.display = "block"; // Force display
          liveColorPreview.style.opacity = "1"; // Ensure it's visible

          // Position magnifier at bottom right of cursor (original behavior)
          magnifier.style.left = x + 20 + "px";
          magnifier.style.top = y + 20 + "px";
          // Remove the transform centering
          magnifier.style.transform = "";

          // Position the live color preview at a fixed offset from the cursor
          const previewOffsetX = 30; // Pixels to the right
          const previewOffsetY = 150; // Position it well below the magnifier (increased from 30)

          // Calculate position, ensuring it stays within viewport
          const maxLeft = window.innerWidth - 150; // Prevent overflow to the right
          const maxTop = window.innerHeight - 60; // Prevent overflow at the bottom

          const previewLeft = Math.min(x + previewOffsetX, maxLeft);
          const previewTop = Math.min(y + previewOffsetY, maxTop);

          liveColorPreview.style.left = previewLeft + "px";
          liveColorPreview.style.top = previewTop + "px";

          console.log(
            `LiveColorPreview positioned at: ${previewLeft}px, ${previewTop}px`
          );

          // Calculate the area to magnify
          const zoom = 3;
          const magnifierSize = 120;

          // Clear the magnifier canvas
          magnifierCtx.clearRect(0, 0, magnifierSize, magnifierSize);

          // Calculate the source rectangle (area around the cursor in image coordinates)
          const sourceSize = magnifierSize / zoom;
          const sourceX =
            imageX -
            (sourceSize / 2) * (actualImageWidth / displayedImageWidth);
          const sourceY =
            imageY -
            (sourceSize / 2) * (actualImageHeight / displayedImageHeight);

          // Draw the zoomed image to the magnifier canvas
          try {
            console.log("Drawing magnifier content");
            magnifierCtx.drawImage(
              mainImageDisplay,
              // Source rectangle (the area around mouse pointer in image coordinates)
              Math.max(0, sourceX),
              Math.max(0, sourceY),
              Math.min(
                sourceSize * (actualImageWidth / displayedImageWidth),
                actualImageWidth - sourceX
              ),
              Math.min(
                sourceSize * (actualImageHeight / displayedImageHeight),
                actualImageHeight - sourceY
              ),
              // Destination rectangle (the entire magnifier)
              0,
              0,
              magnifierSize,
              magnifierSize
            );

            // Add a circle mask
            magnifierCtx.globalCompositeOperation = "destination-in";
            magnifierCtx.beginPath();
            magnifierCtx.arc(
              magnifierSize / 2,
              magnifierSize / 2,
              magnifierSize / 2,
              0,
              Math.PI * 2
            );
            magnifierCtx.closePath();
            magnifierCtx.fill();

            // Reset composite operation
            magnifierCtx.globalCompositeOperation = "source-over";

            // Draw crosshair in the center
            const centerX = magnifierSize / 2;
            const centerY = magnifierSize / 2;
            const crosshairSize = 10;

            // Get the color at the center point for the live preview
            try {
              // Convert the center point to image coordinates
              const centerImageX = Math.floor(imageX);
              const centerImageY = Math.floor(imageY);

              // Make sure we're within image bounds
              if (
                centerImageX >= 0 &&
                centerImageX < actualImageWidth &&
                centerImageY >= 0 &&
                centerImageY < actualImageHeight
              ) {
                // Get pixel color from the canvas
                const centerPixel = window._colorPickerCtx.getImageData(
                  centerImageX,
                  centerImageY,
                  1,
                  1
                ).data;
                const r = centerPixel[0];
                const g = centerPixel[1];
                const b = centerPixel[2];
                const hexColor = rgbToHex(r, g, b);

                console.log(`Color at cursor: ${hexColor} (${r},${g},${b})`);

                // Update the live color preview
                const liveColorBox = document.getElementById("liveColorBox");
                const liveColorHex = document.getElementById("liveColorHex");

                if (!liveColorBox || !liveColorHex) {
                  console.error("Live color preview elements not found!");
                } else {
                  console.log(
                    "Setting live color box background to:",
                    hexColor
                  );

                  // Create a new div with the correct background color
                  const newColorBox = document.createElement("div");
                  newColorBox.id = "liveColorBox";
                  newColorBox.className =
                    "w-6 h-6 rounded border border-gray-300 dark:border-gray-600";
                  newColorBox.style.backgroundColor = hexColor;

                  // Replace the old color box with the new one
                  const oldColorBox = document.getElementById("liveColorBox");
                  if (oldColorBox && oldColorBox.parentNode) {
                    oldColorBox.parentNode.replaceChild(
                      newColorBox,
                      oldColorBox
                    );
                  }

                  // Still update the text display
                  liveColorHex.textContent = hexColor;
                }
              }
            } catch (error) {
              console.error("Error getting color for live preview:", error);
            }

            // Set crosshair style
            magnifierCtx.strokeStyle = "rgba(255, 255, 255, 0.8)";
            magnifierCtx.lineWidth = 1;

            // Draw horizontal line with shadow effect
            magnifierCtx.beginPath();
            magnifierCtx.moveTo(centerX - crosshairSize, centerY);
            magnifierCtx.lineTo(centerX + crosshairSize, centerY);
            magnifierCtx.stroke();

            // Draw vertical line with shadow effect
            magnifierCtx.beginPath();
            magnifierCtx.moveTo(centerX, centerY - crosshairSize);
            magnifierCtx.lineTo(centerX, centerY + crosshairSize);
            magnifierCtx.stroke();

            // Add a contrasting color for better visibility
            magnifierCtx.strokeStyle = "rgba(0, 0, 0, 0.5)";
            magnifierCtx.lineWidth = 0.5;

            // Draw horizontal line with shadow effect
            magnifierCtx.beginPath();
            magnifierCtx.moveTo(centerX - crosshairSize + 1, centerY + 1);
            magnifierCtx.lineTo(centerX + crosshairSize + 1, centerY + 1);
            magnifierCtx.stroke();

            // Draw vertical line with shadow effect
            magnifierCtx.beginPath();
            magnifierCtx.moveTo(centerX + 1, centerY - crosshairSize + 1);
            magnifierCtx.lineTo(centerX + 1, centerY + crosshairSize + 1);
            magnifierCtx.stroke();
          } catch (error) {
            console.error("Error drawing magnifier:", error);
          }
        });

        // Mouse leave handler
        mainImageContainer.addEventListener("mouseleave", function () {
          console.log("Mouse left the container, hiding magnifier");
          magnifier.classList.add("hidden");
          colorInfo.classList.add("hidden");

          // Also hide the live color preview
          const liveColorPreview = document.getElementById("liveColorPreview");
          liveColorPreview.classList.add("hidden");
          liveColorPreview.style.display = "none"; // Force hide
          liveColorPreview.style.opacity = "0"; // Ensure it's invisible
          console.log("Live color preview hidden on mouseleave");
        });

        // Helper function to convert RGB to HEX
        function rgbToHex(r, g, b) {
          return (
            "#" +
            ((1 << 24) + (r << 16) + (g << 8) + b)
              .toString(16)
              .slice(1)
              .toUpperCase()
          );
        }

        // Click handler for color picking
        mainImageContainer.addEventListener("click", function (e) {
          if (!imageLoaded) {
            console.log("Image not loaded yet, skipping color pick");
            return;
          }
          // Use window._colorPickerCanvas and window._colorPickerCtx directly in the code below

          console.log("Image clicked, picking color");

          const rect = mainImageDisplay.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;

          // Calculate the actual displayed image dimensions
          const actualImageWidth = mainImageDisplay.naturalWidth;
          const actualImageHeight = mainImageDisplay.naturalHeight;

          // Calculate the displayed image dimensions (maintaining aspect ratio)
          let displayedImageWidth, displayedImageHeight;
          const containerRatio = rect.width / rect.height;
          const imageRatio = actualImageWidth / actualImageHeight;

          if (imageRatio > containerRatio) {
            displayedImageWidth = rect.width;
            displayedImageHeight = rect.width / imageRatio;
          } else {
            displayedImageHeight = rect.height;
            displayedImageWidth = rect.height * imageRatio;
          }

          // Calculate the position where the actual image starts (centered in container)
          const imageOffsetX = (rect.width - displayedImageWidth) / 2;
          const imageOffsetY = (rect.height - displayedImageHeight) / 2;

          // Check if click is on the actual image (not just the container)
          if (
            x < imageOffsetX ||
            x > imageOffsetX + displayedImageWidth ||
            y < imageOffsetY ||
            y > imageOffsetY + displayedImageHeight
          ) {
            console.log("Click outside image bounds, ignoring");
            return;
          }

          // Convert container coordinates to image coordinates
          const imageX = Math.floor(
            ((x - imageOffsetX) / displayedImageWidth) * actualImageWidth
          );
          const imageY = Math.floor(
            ((y - imageOffsetY) / displayedImageHeight) * actualImageHeight
          );

          // Use the global canvas/context for color picking
          const canvas = window._colorPickerCanvas;
          const ctx = window._colorPickerCtx;
          try {
            const pixel = ctx.getImageData(imageX, imageY, 1, 1).data;
            const r = pixel[0];
            const g = pixel[1];
            const b = pixel[2];
            const hexColor = rgbToHex(r, g, b);

            console.log(`Clicked on color: ${hexColor}`);

            // Show color info
            const colorBox = document.getElementById("colorBox");
            const colorHex = document.getElementById("colorHex");
            colorBox.style.backgroundColor = hexColor;
            colorHex.textContent = hexColor;
            colorInfo.classList.remove("hidden");
            colorInfo.style.left = x + 20 + "px";
            colorInfo.style.top = y - 30 + "px";
            setTimeout(() => {
              colorInfo.classList.add("hidden");
            }, 3000);

            // Update all color info and palette sections but don't copy to clipboard
            selectColor(hexColor, true);
          } catch (error) {
            console.error("Error picking color:", error);
          }
        });
      });

      // Function to add a clicked color to the palette and update color details
      function addClickedColorToPalette(hexColor) {
        // Show color details section
        const colorDetailsContainer = document.getElementById(
          "colorDetailsContainer"
        );
        if (colorDetailsContainer)
          colorDetailsContainer.classList.remove("hidden");
        // Optionally show color variations section
        const colorVariationsContainer = document.getElementById(
          "colorVariationsContainer"
        );
        if (colorVariationsContainer)
          colorVariationsContainer.classList.remove("hidden");
        // Add to extracted color palette (if not already present, up to 5 colors)
        const extractedColorsContainer = document.getElementById(
          "extractedColorsContainer"
        );
        if (!extractedColorsContainer) return;
        extractedColorsContainer.classList.remove("hidden");
        let colorPalette = document.getElementById("colorPalette");
        if (!colorPalette) {
          // Create palette if it doesn't exist
          colorPalette = document.createElement("div");
          colorPalette.className = "color-palette";
          colorPalette.id = "colorPalette";
          extractedColorsContainer.appendChild(colorPalette);
        }
        // Check for duplicates
        const existingColors = Array.from(
          colorPalette.querySelectorAll(".color-item")
        );
        let alreadyExists = false;
        existingColors.forEach((item) => {
          const hex = item.querySelector(".color-hex");
          if (
            hex &&
            "#" + hex.textContent.toUpperCase() === hexColor.toUpperCase()
          ) {
            alreadyExists = true;
            // Highlight if already exists
            item.classList.add("highlight-pulse");
            setTimeout(() => item.classList.remove("highlight-pulse"), 1000);
          }
        });
        if (!alreadyExists) {
          // Remove last if more than 4
          if (existingColors.length >= 5) {
            colorPalette.removeChild(existingColors[existingColors.length - 1]);
          }
          // Create new color item
          const colorItem = document.createElement("div");
          colorItem.className = "color-item";
          colorItem.style.backgroundColor = hexColor;
          // Hex span
          const colorHex = document.createElement("span");
          colorHex.className = "color-hex";
          colorHex.textContent = hexColor.toUpperCase().replace("#", "");
          // Percent span (label as 'Selected')
          const colorPercent = document.createElement("span");
          colorPercent.className = "color-percent";
          colorPercent.textContent = "Selected";
          colorItem.appendChild(colorHex);
          colorItem.appendChild(colorPercent);
          // Click handler for palette item
          colorItem.addEventListener("click", function () {
            selectColor(hexColor, false); // Explicitly set skipCopy to false to ensure it copies to clipboard
          });
          // Add to beginning
          if (colorPalette.firstChild) {
            colorPalette.insertBefore(colorItem, colorPalette.firstChild);
          } else {
            colorPalette.appendChild(colorItem);
          }
          // Highlight
          colorItem.classList.add("highlight-pulse");
          setTimeout(() => colorItem.classList.remove("highlight-pulse"), 1000);
        }

        // Update color details section
        updateColorDetails(hexColor);
      }

      // Helper to update color details section (hex, RGB, HSL, HSV, CMYK, etc.)
      function updateColorDetails(hexColor) {
        console.log("updateColorDetails called with:", hexColor);

        const selectedColorBox = document.getElementById("selectedColorBox");
        const hexValue = document.getElementById("hexValue");
        const colorName = document.getElementById("colorName");
        const exampleBg = document.getElementById("exampleBg");
        const exampleText = document.getElementById("exampleText");

        console.log("Elements:", {
          selectedColorBox: selectedColorBox ? "Found" : "Not found",
          hexValue: hexValue ? "Found" : "Not found",
          colorName: colorName ? "Found" : "Not found",
          exampleBg: exampleBg ? "Found" : "Not found",
          exampleText: exampleText ? "Found" : "Not found",
        });

        if (selectedColorBox) selectedColorBox.style.backgroundColor = hexColor;
        if (hexValue) hexValue.textContent = hexColor;

        // Parse the hex color to RGB
        const r = parseInt(hexColor.slice(1, 3), 16);
        const g = parseInt(hexColor.slice(3, 5), 16);
        const b = parseInt(hexColor.slice(5, 7), 16);

        // Calculate brightness using the perceived brightness formula
        const brightness = (r * 299 + g * 587 + b * 114) / 1000;
        // Determine appropriate contrast color
        const contrastColor = brightness < 128 ? "#ffffff" : "#000000";

        if (hexValue) {
          hexValue.textContent = hexColor;
          hexValue.style.color = contrastColor;
          // Add a subtle text shadow for better visibility when text and bg have similar colors
          hexValue.style.textShadow =
            brightness < 128
              ? "0px 0px 2px rgba(0,0,0,0.5)"
              : "0px 0px 2px rgba(255,255,255,0.5)";
        }

        if (colorName) {
          colorName.textContent = getColorName(hexColor);
          colorName.style.opacity = 1; // Make sure color name is visible
        }

        if (exampleBg) {
          exampleBg.style.backgroundColor = hexColor;

          // Find the span element inside exampleBg
          const textSpan = exampleBg.querySelector("span");
          if (textSpan) {
            // Set text to white for dark backgrounds, black for light ones
            textSpan.style.color = contrastColor;
          }
        }

        if (exampleText) exampleText.style.color = hexColor;

        // Update programming language syntax examples
        updateColorSyntax(hexColor, r, g, b);

        // Call the new functions for updating color models and variations
        updateColorModels(hexColor);
        createColorVariations(hexColor);
      }

      // Function to update code syntax for different programming languages
      function updateColorSyntax(hexColor, r, g, b) {
        // Normalize RGB values to 0-1 range for Swift
        const rNorm = (r / 255).toFixed(2);
        const gNorm = (g / 255).toFixed(2);
        const bNorm = (b / 255).toFixed(2);

        // Update CSS
        const cssSyntax = document.getElementById("cssSyntax");
        if (cssSyntax) cssSyntax.textContent = `color: ${hexColor};`;

        // Update HTML
        const htmlSyntax = document.getElementById("htmlSyntax");
        if (htmlSyntax)
          htmlSyntax.textContent = `<div style="color: ${hexColor};"></div>`;

        // Update JavaScript
        const jsSyntax = document.getElementById("jsSyntax");
        if (jsSyntax)
          jsSyntax.textContent = `element.style.color = '${hexColor}';`;

        // Update Android/Java
        const androidSyntax = document.getElementById("androidSyntax");
        if (androidSyntax)
          androidSyntax.textContent = `int color = Color.parseColor("${hexColor}");`;

        // Update Swift
        const swiftSyntax = document.getElementById("swiftSyntax");
        if (swiftSyntax)
          swiftSyntax.textContent = `UIColor(red: ${rNorm}, green: ${gNorm}, blue: ${bNorm}, alpha: 1.0)`;

        // Update Flutter/Dart
        const dartSyntax = document.getElementById("dartSyntax");
        if (dartSyntax) {
          // Convert hex to 0xFFRRGGBB format for Flutter
          const hexWithoutHash = hexColor.substring(1).toUpperCase();
          dartSyntax.textContent = `Color(0xFF${hexWithoutHash})`;
        }

        // Update SCSS
        const scssSyntax = document.getElementById("scssSyntax");
        if (scssSyntax) scssSyntax.textContent = `$color: ${hexColor};`;

        // Update Tailwind CSS
        const tailwindSyntax = document.getElementById("tailwindSyntax");
        if (tailwindSyntax)
          tailwindSyntax.textContent = `colors: { custom: '${hexColor}' }`;
      }

      // Add color selection function to the palette
      // Add a function to get color names based on hex codes
      window.getColorName = function (hexColor) {
        // Convert hex to RGB first
        let r = 0,
          g = 0,
          b = 0;

        // 3 digits
        if (hexColor.length === 4) {
          r = parseInt(hexColor[1] + hexColor[1], 16);
          g = parseInt(hexColor[2] + hexColor[2], 16);
          b = parseInt(hexColor[3] + hexColor[3], 16);
        }
        // 6 digits
        else if (hexColor.length === 7) {
          r = parseInt(hexColor.substring(1, 3), 16);
          g = parseInt(hexColor.substring(3, 5), 16);
          b = parseInt(hexColor.substring(5, 7), 16);
        }

        // Common color names with their RGB values
        const colorNames = [
          { name: "Black", rgb: [0, 0, 0] },
          { name: "White", rgb: [255, 255, 255] },
          { name: "Red", rgb: [255, 0, 0] },
          { name: "Green", rgb: [0, 128, 0] },
          { name: "Blue", rgb: [0, 0, 255] },
          { name: "Yellow", rgb: [255, 255, 0] },
          { name: "Cyan", rgb: [0, 255, 255] },
          { name: "Magenta", rgb: [255, 0, 255] },
          { name: "Silver", rgb: [192, 192, 192] },
          { name: "Gray", rgb: [128, 128, 128] },
          { name: "Maroon", rgb: [128, 0, 0] },
          { name: "Olive", rgb: [128, 128, 0] },
          { name: "Navy", rgb: [0, 0, 128] },
          { name: "Purple", rgb: [128, 0, 128] },
          { name: "Teal", rgb: [0, 128, 128] },
          { name: "Orange", rgb: [255, 165, 0] },
          { name: "Pink", rgb: [255, 192, 203] },
          { name: "Brown", rgb: [165, 42, 42] },
          { name: "Indigo", rgb: [75, 0, 130] },
          { name: "Violet", rgb: [238, 130, 238] },
          { name: "Turquoise", rgb: [64, 224, 208] },
          { name: "Coral", rgb: [255, 127, 80] },
          { name: "Gold", rgb: [255, 215, 0] },
          { name: "Salmon", rgb: [250, 128, 114] },
          { name: "Khaki", rgb: [240, 230, 140] },
          { name: "Sky Blue", rgb: [135, 206, 235] },
          { name: "Slate Gray", rgb: [112, 128, 144] },
          { name: "Slate Blue", rgb: [106, 90, 205] },
          { name: "Dark Green", rgb: [0, 100, 0] },
          { name: "Forest Green", rgb: [34, 139, 34] },
          { name: "Crimson", rgb: [220, 20, 60] },
          { name: "Tan", rgb: [210, 180, 140] },
          { name: "Beige", rgb: [245, 245, 220] },
          { name: "Chocolate", rgb: [210, 105, 30] },
          { name: "Tomato", rgb: [255, 99, 71] },
          { name: "Lavender", rgb: [230, 230, 250] },
          { name: "Steel Blue", rgb: [70, 130, 180] },
          { name: "Orchid", rgb: [218, 112, 214] },
          { name: "Midnight Blue", rgb: [25, 25, 112] },
          { name: "Slate Gray", rgb: [112, 128, 144] },
        ];

        // Find the closest color name
        let minDistance = Number.MAX_VALUE;
        let closestColor = "Unknown";

        for (const color of colorNames) {
          const distance = Math.sqrt(
            Math.pow(r - color.rgb[0], 2) +
              Math.pow(g - color.rgb[1], 2) +
              Math.pow(b - color.rgb[2], 2)
          );

          if (distance < minDistance) {
            minDistance = distance;
            closestColor = color.name;
          }
        }

        // Return with brightness indicator
        let brightness = (r * 299 + g * 587 + b * 114) / 1000;
        let shade = "";

        if (brightness > 200) shade = "Light ";
        else if (brightness < 50) shade = "Dark ";
        else if (brightness >= 50 && brightness <= 200) {
          // Only add shade prefix if not already in the color name
          if (
            !closestColor.includes("Light") &&
            !closestColor.includes("Dark")
          ) {
            if (brightness < 100) shade = "Deep ";
            else if (brightness < 150) shade = "Medium ";
          }
        }

        return minDistance < 50 ? shade + closestColor : shade + "Custom Color";
      };

      // Add the missing color model update functions
      function updateColorModels(hexColor) {
        // Convert hex to RGB
        const rgb = hexToRgb(hexColor);
        if (!rgb) return;

        const [r, g, b] = rgb;

        // Update RGB
        setText("rgbR", r);
        setText("rgbG", g);
        setText("rgbB", b);
        setBar("rgbRBar", (r / 255) * 100);
        setBar("rgbGBar", (g / 255) * 100);
        setBar("rgbBBar", (b / 255) * 100);

        // Update HSL
        const [h, s, l] = rgbToHsl(r, g, b);
        setText("hslH", `${Math.round(h)}`);
        setText("hslS", `${Math.round(s)}%`);
        setText("hslL", `${Math.round(l)}%`);
        setBar("hslSBar", s);
        setMarker("hslHMarker", (h / 360) * 100);
        setMarker("hslLMarker", l);

        // Update HSV
        const [hh, ss, v] = rgbToHsv(r, g, b);
        setText("hsvH", `${Math.round(hh)}`);
        setText("hsvS", `${Math.round(ss)}%`);
        setText("hsvV", `${Math.round(v)}%`);
        setBar("hsvSBar", ss);
        setMarker("hsvHMarker", (hh / 360) * 100);
        setMarker("hsvVMarker", v);

        // Update CMYK
        const [c, m, y, k] = rgbToCmyk(r, g, b);
        setText("cmykC", `${Math.round(c)}%`);
        setText("cmykM", `${Math.round(m)}%`);
        setText("cmykY", `${Math.round(y)}%`);
        setText("cmykK", `${Math.round(k)}%`);
        setBar("cmykCBar", c);
        setBar("cmykMBar", m);
        setBar("cmykYBar", y);
        setBar("cmykKBar", k);
      }

      // Function to copy a shade or tint to clipboard without selecting it
      function copyShadeOrTint(hexColor) {
        // Only copy to clipboard without selecting the color
        navigator.clipboard
          .writeText(hexColor)
          .then(() => {
            // Show a toast notification
            showToast(`Copied ${hexColor} to clipboard`);
          })
          .catch((err) => {
            console.error("Failed to copy: ", err);
          });
      }

      // Create color variations (shades and tints)
      function createColorVariations(hexColor) {
        const rgb = hexToRgb(hexColor);
        if (!rgb) return;

        const [r, g, b] = rgb;
        const shadesContainer = document.getElementById("shadesContainer");
        const tintsContainer = document.getElementById("tintsContainer");

        if (shadesContainer) shadesContainer.innerHTML = "";
        if (tintsContainer) tintsContainer.innerHTML = "";

        // Generate 7 shades (darker)
        for (let i = 1; i <= 7; i++) {
          const factor = 1 - i * 0.1;
          const shade = [
            Math.round(r * factor),
            Math.round(g * factor),
            Math.round(b * factor),
          ];
          const shadeHex = window.rgbToHex(shade[0], shade[1], shade[2]);

          const div = document.createElement("div");
          div.className = "shade-item";
          div.innerHTML = `<div class='color-box' style='background:${shadeHex}'></div><div class='color-info'>${shadeHex}</div>`;
          div.title = shadeHex;
          div.onclick = () => copyShadeOrTint(shadeHex);
          shadesContainer.appendChild(div);
        }

        // Generate 7 tints (lighter)
        for (let i = 1; i <= 7; i++) {
          const factor = i * 0.1;
          const tint = [
            Math.round(r + (255 - r) * factor),
            Math.round(g + (255 - g) * factor),
            Math.round(b + (255 - b) * factor),
          ];
          const tintHex = window.rgbToHex(tint[0], tint[1], tint[2]);

          const div = document.createElement("div");
          div.className = "tint-item";
          div.innerHTML = `<div class='color-box' style='background:${tintHex}'></div><div class='color-info'>${tintHex}</div>`;
          div.title = tintHex;
          div.onclick = () => copyShadeOrTint(tintHex);
          tintsContainer.appendChild(div);
        }

        // Generate color harmonies
        createColorHarmonies(hexColor);
      }

      // Function to create color harmonies based on a selected color
      function createColorHarmonies(hexColor) {
        const rgb = hexToRgb(hexColor);
        if (!rgb) return;

        const [r, g, b] = rgb;
        // Convert RGB to HSL for easier color manipulation
        const [h, s, l] = rgbToHsl(r, g, b);

        // Create color squares for each harmony
        createComplementaryColors(h, s, l);
        createMonochromaticColors(h, s, l);
        createAnalogousColors(h, s, l);
        createTriadicColors(h, s, l);
        createTetradicColors(h, s, l);
      }

      // Function to create a color square element
      function createColorSquare(
        hexColor,
        index = 0,
        isBaseColor = false,
        isLast = false
      ) {
        const div = document.createElement("div");
        div.className = "color-square relative cursor-pointer";
        div.style.backgroundColor = hexColor;
        div.style.width = "100%"; // Take full width of container
        div.style.height = isBaseColor ? "60px" : "55px";
        div.style.margin = "0";
        div.style.borderRadius = "0"; // Remove border radius for connected appearance

        // Add first item rounded corners
        if (index === 0) {
          div.style.borderTopLeftRadius = "6px";
          div.style.borderBottomLeftRadius = "6px";
        }

        // Add last item rounded corners
        if (isLast) {
          div.style.borderTopRightRadius = "6px";
          div.style.borderBottomRightRadius = "6px";
        }

        // Base color indicator
        if (isBaseColor) {
          div.style.boxShadow = "inset 0 -3px 0 0 #3b82f6"; // Solid blue indicator at bottom

          // Base color label - positioned in the center above the color
          const indicator = document.createElement("div");
          indicator.className =
            "absolute px-1.5 py-0.5 bg-blue-500 text-white text-xs rounded";
          indicator.textContent = "Base";
          indicator.style.top = "-18px"; // Position above the color square
          indicator.style.left = "50%";
          indicator.style.transform = "translateX(-50%)";
          indicator.style.zIndex = "5";
          div.appendChild(indicator);
        }

        div.onclick = () => copyToClipboard(hexColor);

        // Create a tooltip that shows the hex value
        const tooltip = document.createElement("span");
        tooltip.className =
          "absolute -bottom-7 left-1/2 transform -translate-x-1/2 bg-black text-white text-xs px-2 py-1 rounded opacity-0 transition-opacity duration-200";
        tooltip.textContent = hexColor;
        tooltip.style.whiteSpace = "nowrap";
        tooltip.style.zIndex = "20";
        div.appendChild(tooltip);

        // Show tooltip on hover
        div.addEventListener("mouseenter", () => {
          tooltip.style.opacity = "1";
        });

        div.addEventListener("mouseleave", () => {
          tooltip.style.opacity = "0";
        });

        return div;
      }

      // Function to create complementary colors
      function createComplementaryColors(h, s, l) {
        const container = document.getElementById("complementaryColors");
        if (!container) return;

        container.innerHTML = "";
        container.style.display = "flex";
        container.style.width = "100%";
        container.style.border = "1px solid #e5e7eb"; // Solid border instead of transparent
        container.style.borderRadius = "6px";
        container.style.overflow = "hidden";

        // Base color
        const baseHsl = [h, s, l];
        const baseColor = hslToHex(baseHsl[0], baseHsl[1], baseHsl[2]);
        container.appendChild(createColorSquare(baseColor, 0, true));

        // Complementary color (opposite on the color wheel)
        const compH = (h + 180) % 360;
        const compColor = hslToHex(compH, s, l);
        container.appendChild(createColorSquare(compColor, 1, false, true));
      }

      // Function to create monochromatic colors
      function createMonochromaticColors(h, s, l) {
        const container = document.getElementById("monochromaticColors");
        if (!container) return;

        container.innerHTML = "";
        container.style.display = "flex";
        container.style.width = "100%";
        container.style.border = "1px solid #e5e7eb"; // Solid border instead of transparent
        container.style.borderRadius = "6px";
        container.style.overflow = "hidden";

        // Create 3 monochromatic colors with different lightness
        const baseColor = hslToHex(h, s, l);
        container.appendChild(createColorSquare(baseColor, 0, true));

        // Darker shade
        const darkColor = hslToHex(h, s, Math.max(20, l - 30));
        container.appendChild(createColorSquare(darkColor, 1));

        // Lighter tint
        const lightColor = hslToHex(h, s, Math.min(95, l + 30));
        container.appendChild(createColorSquare(lightColor, 2, false, true));
      }

      // Function to create analogous colors
      function createAnalogousColors(h, s, l) {
        const container = document.getElementById("analogousColors");
        if (!container) return;

        container.innerHTML = "";
        container.style.display = "flex";
        container.style.width = "100%";
        container.style.border = "1px solid #e5e7eb"; // Solid border instead of transparent
        container.style.borderRadius = "6px";
        container.style.overflow = "hidden";

        // Create 3 analogous colors (next to each other on color wheel)

        // Color 30 degrees counterclockwise
        const color1 = hslToHex((h - 30 + 360) % 360, s, l);
        container.appendChild(createColorSquare(color1, 0));

        // Base color
        const baseColor = hslToHex(h, s, l);
        container.appendChild(createColorSquare(baseColor, 1, true));

        // Color 30 degrees clockwise
        const color2 = hslToHex((h + 30) % 360, s, l);
        container.appendChild(createColorSquare(color2, 2, false, true));
      }

      // Function to create triadic colors
      function createTriadicColors(h, s, l) {
        const container = document.getElementById("triadicColors");
        if (!container) return;

        container.innerHTML = "";
        container.style.display = "flex";
        container.style.width = "100%";
        container.style.border = "1px solid #e5e7eb"; // Solid border instead of transparent
        container.style.borderRadius = "6px";
        container.style.overflow = "hidden";

        // Create 3 triadic colors (evenly spaced on color wheel)
        const baseColor = hslToHex(h, s, l);
        container.appendChild(createColorSquare(baseColor, 0, true));

        // 120 degrees from base
        const color1 = hslToHex((h + 120) % 360, s, l);
        container.appendChild(createColorSquare(color1, 1));

        // 240 degrees from base
        const color2 = hslToHex((h + 240) % 360, s, l);
        container.appendChild(createColorSquare(color2, 2, false, true));
      }

      // Function to create tetradic colors
      function createTetradicColors(h, s, l) {
        const container = document.getElementById("tetradicColors");
        if (!container) return;

        container.innerHTML = "";
        container.style.display = "flex";
        container.style.width = "100%";
        container.style.border = "1px solid #e5e7eb"; // Solid border instead of transparent
        container.style.borderRadius = "6px";
        container.style.overflow = "hidden";

        // Create 4 tetradic colors (rectangle on color wheel)
        const baseColor = hslToHex(h, s, l);
        container.appendChild(createColorSquare(baseColor, 0, true));

        // 90 degrees from base
        const color1 = hslToHex((h + 90) % 360, s, l);
        container.appendChild(createColorSquare(color1, 1));

        // 180 degrees from base (complementary)
        const color2 = hslToHex((h + 180) % 360, s, l);
        container.appendChild(createColorSquare(color2, 2));

        // 270 degrees from base
        const color3 = hslToHex((h + 270) % 360, s, l);
        container.appendChild(createColorSquare(color3, 3, false, true));
      }

      // Convert HSL to Hex
      function hslToHex(h, s, l) {
        s /= 100;
        l /= 100;

        const c = (1 - Math.abs(2 * l - 1)) * s;
        const x = c * (1 - Math.abs(((h / 60) % 2) - 1));
        const m = l - c / 2;

        let r, g, b;

        if (h >= 0 && h < 60) {
          [r, g, b] = [c, x, 0];
        } else if (h >= 60 && h < 120) {
          [r, g, b] = [x, c, 0];
        } else if (h >= 120 && h < 180) {
          [r, g, b] = [0, c, x];
        } else if (h >= 180 && h < 240) {
          [r, g, b] = [0, x, c];
        } else if (h >= 240 && h < 300) {
          [r, g, b] = [x, 0, c];
        } else {
          [r, g, b] = [c, 0, x];
        }

        r = Math.round((r + m) * 255);
        g = Math.round((g + m) * 255);
        b = Math.round((b + m) * 255);

        return window.rgbToHex(r, g, b);
      }

      // Copy shades or tints
      function copyShadeOrTint(color) {
        copyToClipboard(color);
      }

      // Helper functions for color model updates
      function setText(id, val) {
        const el = document.getElementById(id);
        if (el) el.textContent = val;
      }

      function setBar(id, percent) {
        const el = document.getElementById(id);
        if (el) el.style.width = percent + "%";
      }

      function setMarker(id, percent) {
        const el = document.getElementById(id);
        if (el) el.style.left = percent + "%";
      }

      // Color conversion helper functions
      function hexToRgb(hex) {
        hex = hex.replace("#", "");
        if (hex.length === 3) {
          hex = hex
            .split("")
            .map((x) => x + x)
            .join("");
        }
        const num = parseInt(hex, 16);
        return [(num >> 16) & 255, (num >> 8) & 255, num & 255];
      }

      function rgbToHsl(r, g, b) {
        r /= 255;
        g /= 255;
        b /= 255;
        const max = Math.max(r, g, b),
          min = Math.min(r, g, b);
        let h,
          s,
          l = (max + min) / 2;

        if (max === min) {
          h = s = 0;
        } else {
          const d = max - min;
          s = l > 0.5 ? d / (2 - max - min) : d / (max + min);

          switch (max) {
            case r:
              h = (g - b) / d + (g < b ? 6 : 0);
              break;
            case g:
              h = (b - r) / d + 2;
              break;
            case b:
              h = (r - g) / d + 4;
              break;
          }
          h *= 60;
        }

        return [h, s * 100, l * 100];
      }

      function rgbToHsv(r, g, b) {
        r /= 255;
        g /= 255;
        b /= 255;
        const max = Math.max(r, g, b),
          min = Math.min(r, g, b);
        let h,
          s,
          v = max;

        const d = max - min;
        s = max === 0 ? 0 : d / max;

        if (max === min) {
          h = 0;
        } else {
          switch (max) {
            case r:
              h = (g - b) / d + (g < b ? 6 : 0);
              break;
            case g:
              h = (b - r) / d + 2;
              break;
            case b:
              h = (r - g) / d + 4;
              break;
          }
          h *= 60;
        }

        return [h, s * 100, v * 100];
      }

      function rgbToCmyk(r, g, b) {
        if (r === 0 && g === 0 && b === 0) {
          return [0, 0, 0, 100];
        }

        r /= 255;
        g /= 255;
        b /= 255;

        const k = 1 - Math.max(r, g, b);
        const c = ((1 - r - k) / (1 - k)) * 100;
        const m = ((1 - g - k) / (1 - k)) * 100;
        const y = ((1 - b - k) / (1 - k)) * 100;

        return [c, m, y, k * 100];
      }

      // Color Contrast Checker Functionality
      document.addEventListener("DOMContentLoaded", function () {
        // Get elements
        const textColorPreview = document.getElementById("textColorPreview");
        const textColorInput = document.getElementById("textColorInput");
        const textColorPicker = document.getElementById("textColorPicker");
        const bgColorPreview = document.getElementById("bgColorPreview");
        const bgColorInput = document.getElementById("bgColorInput");
        const bgColorPicker = document.getElementById("bgColorPicker");
        const contrastPreview = document.getElementById("contrastPreview");
        const contrastRatio = document.getElementById("contrastRatio");
        const contrastRating = document.getElementById("contrastRating");
        const contrastStars = document.getElementById("contrastStars");
        const smallTextStars = document.getElementById("smallTextStars");
        const largeTextStars = document.getElementById("largeTextStars");
        const swapColorsBtn = document.getElementById("swapColorsBtn");
        const useSelectedColorBtn = document.getElementById(
          "useSelectedColorBtn"
        );

        // Last selected color from color picker
        let lastSelectedColor = null;

        // Utility to calculate relative luminance from RGB
        function getLuminance(rgb) {
          // Normalize RGB values
          let r = rgb[0] / 255;
          let g = rgb[1] / 255;
          let b = rgb[2] / 255;

          // Apply transformations
          r = r <= 0.03928 ? r / 12.92 : Math.pow((r + 0.055) / 1.055, 2.4);
          g = g <= 0.03928 ? g / 12.92 : Math.pow((g + 0.055) / 1.055, 2.4);
          b = b <= 0.03928 ? b / 12.92 : Math.pow((b + 0.055) / 1.055, 2.4);

          // Calculate luminance
          return 0.2126 * r + 0.7152 * g + 0.0722 * b;
        }

        // Parse hex color to RGB array
        function hexToRgb(hex) {
          // Remove # if present
          hex = hex.replace("#", "");

          // Convert 3-character hex to 6-character
          if (hex.length === 3) {
            hex = hex
              .split("")
              .map((char) => char + char)
              .join("");
          }

          // Parse the hex values
          const r = parseInt(hex.substring(0, 2), 16);
          const g = parseInt(hex.substring(2, 4), 16);
          const b = parseInt(hex.substring(4, 6), 16);

          // Check if parsing resulted in valid numbers
          if (isNaN(r) || isNaN(g) || isNaN(b)) {
            return [0, 0, 0]; // Return black if invalid
          }

          return [r, g, b];
        }

        // Calculate contrast ratio
        function calculateContrastRatio(color1, color2) {
          const lum1 = getLuminance(hexToRgb(color1));
          const lum2 = getLuminance(hexToRgb(color2));

          // Ensure lighter color is first for calculation
          const lighter = Math.max(lum1, lum2);
          const darker = Math.min(lum1, lum2);

          // Calculate ratio
          return (lighter + 0.05) / (darker + 0.05);
        }

        // Format contrast ratio for display
        function formatContrastRatio(ratio) {
          return `${ratio.toFixed(2)}`;
        }

        // Get rating based on contrast ratio
        function getRating(ratio) {
          if (ratio >= 12) return "Excellent";
          if (ratio >= 7) return "Very good";
          if (ratio >= 4.5) return "Good";
          if (ratio >= 3) return "Moderate";
          return "Poor";
        }

        // Generate star rating HTML (filled and empty stars)
        function generateStars(count, total = 5) {
          // Ensure count is between 0 and total
          count = Math.max(0, Math.min(Math.round(count), total));

          // Generate stars HTML
          let starsHtml = "";
          for (let i = 0; i < total; i++) {
            if (i < count) {
              starsHtml +=
                '<span class="text-green-600 dark:text-green-400"></span>';
            } else {
              starsHtml +=
                '<span class="text-gray-300 dark:text-gray-600"></span>';
            }
          }
          return starsHtml;
        }

        // Update stars based on contrast ratio
        function updateStars(ratio) {
          // Overall rating (out of 5 stars)
          const overallStars = Math.min(5, Math.ceil(ratio / 3));
          contrastStars.innerHTML = generateStars(overallStars, 5);

          // Small text (out of 3 stars) - AA (4.5:1) is 2 stars, AAA (7:1) is 3 stars
          let smallStars = 0;
          if (ratio >= 7) smallStars = 3;
          else if (ratio >= 4.5) smallStars = 2;
          else if (ratio >= 3) smallStars = 1;
          smallTextStars.innerHTML = generateStars(smallStars, 3);

          // Large text (out of 3 stars) - AA (3:1) is 2 stars, AAA (4.5:1) is 3 stars
          let largeStars = 0;
          if (ratio >= 4.5) largeStars = 3;
          else if (ratio >= 3) largeStars = 2;
          else if (ratio >= 2) largeStars = 1;
          largeTextStars.innerHTML = generateStars(largeStars, 3);
        }

        // Update the preview with current colors
        function updatePreview() {
          const textColor = textColorInput.value;
          const bgColor = bgColorInput.value;

          // Update the preview background
          contrastPreview.style.backgroundColor = bgColor;

          // Update preview text color
          const previewText = contrastPreview.querySelector("span");
          const previewTextInner = document.getElementById("previewTextInner");

          if (previewText) {
            previewText.style.color = textColor;
          }

          // Update text color input field - set text color to match value
          textColorInput.style.color = textColor;

          // Update background color input field - set text color to match value
          bgColorInput.style.color = bgColor;

          // Update text color preview
          textColorPreview.style.backgroundColor = textColor;
          const textColorPreviewText = document.getElementById(
            "textColorPreviewText"
          );
          if (textColorPreviewText) {
            // Calculate color brightness
            const r = parseInt(textColor.slice(1, 3), 16);
            const g = parseInt(textColor.slice(3, 5), 16);
            const b = parseInt(textColor.slice(5, 7), 16);
            const brightness = (r * 299 + g * 587 + b * 114) / 1000;

            // Set contrast text color
            textColorPreviewText.style.color =
              brightness < 128 ? "#ffffff" : "#000000";
          }

          // Update background color preview
          bgColorPreview.style.backgroundColor = bgColor;
          const bgColorPreviewText =
            document.getElementById("bgColorPreviewText");
          if (bgColorPreviewText) {
            // Calculate color brightness
            const r = parseInt(bgColor.slice(1, 3), 16);
            const g = parseInt(bgColor.slice(3, 5), 16);
            const b = parseInt(bgColor.slice(5, 7), 16);
            const brightness = (r * 299 + g * 587 + b * 114) / 1000;

            // Set contrast text color
            bgColorPreviewText.style.color =
              brightness < 128 ? "#ffffff" : "#000000";
          }

          if (previewTextInner) {
            // Calculate background brightness
            const bgR = parseInt(bgColor.slice(1, 3), 16);
            const bgG = parseInt(bgColor.slice(3, 5), 16);
            const bgB = parseInt(bgColor.slice(5, 7), 16);
            const bgBrightness = (bgR * 299 + bgG * 587 + bgB * 114) / 1000;

            // Calculate the contrast ratio between text and background
            const ratio = calculateContrastRatio(textColor, bgColor);

            // Clear previous classes first
            previewTextInner.classList.remove(
              "text-with-shadow-light",
              "text-with-shadow-dark"
            );

            // If contrast is too low (< 2.5), add a text shadow to improve readability
            if (ratio < 2.5) {
              if (bgBrightness < 128) {
                previewTextInner.classList.add("text-with-shadow-light");
              } else {
                previewTextInner.classList.add("text-with-shadow-dark");
              }
            }
          }

          // Update color picker values
          textColorPicker.value = textColor;
          bgColorPicker.value = bgColor;

          // Calculate contrast ratio
          const ratio = calculateContrastRatio(textColor, bgColor);

          // Update ratio display
          contrastRatio.textContent = formatContrastRatio(ratio);

          // Update rating text
          contrastRating.textContent = getRating(ratio);

          // Update rating color based on ratio
          if (ratio >= 4.5) {
            contrastRatio.className =
              "text-5xl font-bold text-green-800 dark:text-green-400";
            contrastRating.className =
              "text-green-800 dark:text-green-400 font-medium";
          } else if (ratio >= 3) {
            contrastRatio.className =
              "text-5xl font-bold text-yellow-700 dark:text-yellow-400";
            contrastRating.className =
              "text-yellow-700 dark:text-yellow-400 font-medium";
          } else {
            contrastRatio.className =
              "text-5xl font-bold text-red-700 dark:text-red-400";
            contrastRating.className =
              "text-red-700 dark:text-red-400 font-medium";
          }

          // Update star ratings
          updateStars(ratio);
        }

        // Validate and format hex color
        function normalizeHexColor(input) {
          // Remove # if present
          let color = input.replace("#", "").trim();

          // Check if it's a valid hex color
          const isValid = /^[0-9A-Fa-f]{3}$|^[0-9A-Fa-f]{6}$/.test(color);

          if (!isValid) {
            // Return black if invalid
            return "#000000";
          }

          // Convert 3-character hex to 6-character
          if (color.length === 3) {
            color = color
              .split("")
              .map((char) => char + char)
              .join("");
          }

          return "#" + color.toUpperCase();
        }

        // Initialize with default values
        function initContrastChecker() {
          // Set default text color to black
          textColorInput.value = "#000000";
          textColorPicker.value = "#000000";
          textColorPreview.style.backgroundColor = "#000000";

          // Check if there's already a selected color to use
          const selectedColorBox = document.getElementById("selectedColorBox");
          if (selectedColorBox && selectedColorBox.style.backgroundColor) {
            // Convert RGB to Hex if needed
            let selectedColor = selectedColorBox.style.backgroundColor;
            if (selectedColor.startsWith("rgb")) {
              const rgb = selectedColor.match(/\d+/g).map(Number);
              selectedColor = window.rgbToHex(rgb[0], rgb[1], rgb[2]);
            }
            bgColorInput.value = selectedColor;
            bgColorPicker.value = selectedColor;
            bgColorPreview.style.backgroundColor = selectedColor;
          } else {
            // Default to white if no color is selected
            bgColorInput.value = "#FFFFFF";
            bgColorPicker.value = "#FFFFFF";
            bgColorPreview.style.backgroundColor = "#FFFFFF";
          }

          updatePreview();
        }

        // Event listeners for text inputs
        textColorInput.addEventListener("input", function () {
          const normalizedColor = normalizeHexColor(this.value);
          textColorPreview.style.backgroundColor = normalizedColor;
          textColorPicker.value = normalizedColor;
          this.value = normalizedColor;
          this.style.color = normalizedColor; // Update input text color
          updatePreview();
        });

        bgColorInput.addEventListener("input", function () {
          const normalizedColor = normalizeHexColor(this.value);
          bgColorPreview.style.backgroundColor = normalizedColor;
          bgColorPicker.value = normalizedColor;
          this.value = normalizedColor;
          this.style.color = normalizedColor; // Update input text color
          updatePreview();
        });

        // Event listeners for color pickers
        textColorPicker.addEventListener("input", function () {
          textColorInput.value = this.value.toUpperCase();
          textColorPreview.style.backgroundColor = this.value;
          updatePreview();
        });

        bgColorPicker.addEventListener("input", function () {
          bgColorInput.value = this.value.toUpperCase();
          bgColorPreview.style.backgroundColor = this.value;
          updatePreview();
        });

        // Click on color preview to open color picker
        textColorPreview.addEventListener("click", function () {
          textColorPicker.click();
        });

        bgColorPreview.addEventListener("click", function () {
          bgColorPicker.click();
        });

        // Swap colors
        swapColorsBtn.addEventListener("click", function () {
          const textColor = textColorInput.value;
          const bgColor = bgColorInput.value;

          textColorInput.value = bgColor;
          bgColorInput.value = textColor;
          textColorPicker.value = bgColor;
          bgColorPicker.value = textColor;
          textColorPreview.style.backgroundColor = bgColor;
          bgColorPreview.style.backgroundColor = textColor;

          updatePreview();
        });

        // Use the last selected color
        useSelectedColorBtn.addEventListener("click", function () {
          // Get the most recently selected color from clicking the image or palette
          const selectedColorBox = document.getElementById("selectedColorBox");
          if (selectedColorBox) {
            const selectedColor = selectedColorBox.style.backgroundColor;

            // Convert RGB to Hex if needed
            let hexColor = selectedColor;
            if (selectedColor.startsWith("rgb")) {
              const rgb = selectedColor.match(/\d+/g).map(Number);
              hexColor = window.rgbToHex(rgb[0], rgb[1], rgb[2]);
            }

            // Update the background color with the selected color
            bgColorInput.value = hexColor;
            bgColorPicker.value = hexColor;
            bgColorPreview.style.backgroundColor = hexColor;
            updatePreview();
          } else {
            alert(
              "Please select a color first by clicking on the image or palette"
            );
          }
        });

        // Initialize the contrast checker
        initContrastChecker();

        // Hook into color selection to track last selected color
        const originalSelectColor = window.selectColor;
        if (typeof originalSelectColor === "function") {
          window.selectColor = function (color, skipCopy = false) {
            lastSelectedColor = color;

            // Update the contrast checker background color with the newly selected color
            if (bgColorInput && bgColorPreview && bgColorPicker) {
              bgColorInput.value = color;
              bgColorPicker.value = color;
              bgColorPreview.style.backgroundColor = color;
              updatePreview();
            }

            // Call the original function with the same parameters
            originalSelectColor(color, skipCopy);
          };
        }
      });

      // Function to switch color model tabs - removed as we no longer use tabs
    </script>

    <!-- Add keyboard event handling for copying the selected color -->
    <script>
      document.addEventListener("keydown", function (event) {
        // Don't trigger shortcuts if user is in a text input or textarea
        if (
          document.activeElement.tagName === "INPUT" ||
          document.activeElement.tagName === "TEXTAREA"
        ) {
          return;
        }

        // Check if Ctrl+C was pressed (or Cmd+C on Mac)
        if ((event.ctrlKey || event.metaKey) && event.key === "c") {
          // Get the current selected color
          const selectedColorElement =
            document.getElementById("selectedColorHex");
          if (selectedColorElement && selectedColorElement.textContent) {
            // Prevent the default copy behavior
            event.preventDefault();
            // Copy the color to clipboard
            const hexColor = selectedColorElement.textContent;
            copyToClipboard(hexColor);
            console.log("Keyboard shortcut: copied color", hexColor);
          }
        }

        // Space key to copy selected color
        else if (event.key === " " || event.code === "Space") {
          event.preventDefault(); // Prevent page scroll
          const selectedColorElement =
            document.getElementById("selectedColorHex");
          if (selectedColorElement && selectedColorElement.textContent) {
            const hexColor = selectedColorElement.textContent;
            copyToClipboard(hexColor);
            console.log("Space key: copied color", hexColor);
          }
        }

        // 'U' key to upload an image
        else if (event.key === "u" || event.key === "U") {
          event.preventDefault();
          document.getElementById("imageInput").click();
          console.log("U key: triggered file upload");
        }

        // Number keys 1-5 to select colors from palette
        else if (event.key >= "1" && event.key <= "5") {
          event.preventDefault();
          const colorIndex = parseInt(event.key) - 1;
          const colorItems = document.querySelectorAll(".color-item");
          if (colorItems && colorItems.length > colorIndex) {
            // Get the color from the item
            const colorItem = colorItems[colorIndex];
            const colorHex = colorItem.querySelector(".color-hex")?.textContent;
            if (colorHex) {
              // Select this color
              selectColor("#" + colorHex);
              console.log(
                `Number key ${event.key}: selected color #${colorHex}`
              );
            }
          }
        }
      });
    </script>

    <!-- Footer -->
    <footer
      class="bg-gray-100 dark:bg-gray-900 mt-10 py-6 border-t border-gray-200 dark:border-gray-800"
    >
      <div class="container mx-auto px-4">
        <div class="flex flex-col md:flex-row justify-between items-center">
          <div class="mb-4 md:mb-0">
            <p class="text-sm text-gray-600 dark:text-gray-400">
               <span id="current-year">2023</span> ColorPeek. All rights
              reserved.
            </p>
            <script>
              document.getElementById("current-year").textContent =
                new Date().getFullYear();
            </script>
          </div>
          <div class="flex space-x-6">
            <a
              href="about.html"
              class="text-sm text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"
            >
              About
            </a>
            <a
              href="faq.html"
              class="text-sm text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"
            >
              FAQ
            </a>
            <a
              href="contact.html"
              class="text-sm text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"
            >
              Contact
            </a>
            <a
              href="privacy-policy.html"
              class="text-sm text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"
            >
              Privacy Policy
            </a>
            <a
              href="sitemap.html"
              class="text-sm text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white"
            >
              Sitemap
            </a>
          </div>
        </div>
      </div>
    </footer>

    <!-- Mobile Menu Toggle JavaScript -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const mobileMenuToggle = document.getElementById("mobileMenuToggle");
        const mobileNav = document.getElementById("mobileNav");

        if (mobileMenuToggle && mobileNav) {
          mobileMenuToggle.addEventListener("click", function () {
            mobileMenuToggle.classList.toggle("active");
            mobileNav.classList.toggle("active");
            document.body.classList.toggle("mobile-menu-open");
          });

          // Close menu when clicking on links
          const mobileNavLinks = mobileNav.querySelectorAll("a");
          mobileNavLinks.forEach((link) => {
            link.addEventListener("click", function () {
              mobileMenuToggle.classList.remove("active");
              mobileNav.classList.remove("active");
              document.body.classList.remove("mobile-menu-open");
            });
          });
        }
      });
    </script>
  </body>
</html>
